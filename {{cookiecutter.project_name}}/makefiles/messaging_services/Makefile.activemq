# =============================================================================
# ğŸ“¡ ActiveMQ JMS Server Management
# =============================================================================
# This file contains targets for ActiveMQ JMS messaging service
# =============================================================================

.PHONY: activemq-start activemq-dev-start activemq-stop activemq-status activemq-setup run-jms-demo

# Include common configuration
include makefiles/common_services/Makefile.common

# =============================================================================
# ActiveMQ Service Management
# =============================================================================

# ğŸš€ Start ActiveMQ JMS server with setup
activemq-start:
	@echo "Starting ActiveMQ JMS server..."
	$(DOCKER_COMPOSE) --profile activemq up -d activemq activemq-setup
	@echo "â³ Waiting for ActiveMQ to fully initialize..."
	@sleep 15
	@echo "âœ… ActiveMQ started. Web Console: http://localhost:8161/console"
	@echo "ğŸ”‘ Credentials: admin/admin"

# ğŸš€ Start ActiveMQ JMS server for development (no setup)
activemq-dev-start:
	@echo "Starting ActiveMQ JMS server (dev mode)..."
	$(DOCKER_COMPOSE) --profile activemq-dev up -d activemq
	@echo "â³ Waiting for ActiveMQ to fully initialize..."
	@sleep 15
	@echo "âœ… ActiveMQ started in dev mode."

# â›” Stop ActiveMQ JMS server
activemq-stop:
	@echo "Stopping ActiveMQ JMS server..."
	$(DOCKER_COMPOSE) stop activemq activemq-setup 2>/dev/null || true
	@echo "âœ… ActiveMQ stopped."

# ğŸ” Check ActiveMQ JMS server status and connection
activemq-status:
	@echo "ğŸ” Checking ActiveMQ status..."
	@container_status=$$(docker inspect -f '{{.State.Status}}' snaplogic-activemq 2>/dev/null || echo "not found"); \
	if [ "$$container_status" = "running" ]; then \
		echo "âœ… ActiveMQ container is running"; \
		echo "ğŸŒ Web Console: http://localhost:8161/console"; \
		echo "ğŸ“¡ JMS URL: tcp://localhost:61616"; \
		echo "ğŸ”‘ Credentials: admin/admin"; \
		echo "ğŸ§ª Testing web console connection..."; \
		if curl -s -f -u admin:admin http://localhost:8161/console/ >/dev/null 2>&1; then \
			echo "âœ… Web console is accessible"; \
		else \
			echo "âš ï¸  Web console not yet ready (may still be starting)"; \
		fi; \
	else \
		echo "âŒ ActiveMQ container is not running (status: $$container_status)"; \
		echo "ğŸ’¡ Run 'make activemq-start' to start ActiveMQ"; \
	fi

# ğŸ”§ Run ActiveMQ setup and display connection info
activemq-setup:
	@echo "ğŸ”§ Running ActiveMQ setup and displaying connection info..."
	@$(MAKE) activemq-status
	@echo ""
	@echo "ğŸ“‹ Queue Suggestions for SAP IDOC Integration:"
	@echo "   â€¢ sap.idoc.queue - Main queue for SAP IDOC messages"
	@echo "   â€¢ test.queue - Queue for testing and development"
	@echo "   â€¢ demo.queue - Queue for demonstrations"
	@echo ""
	@echo "ğŸ› ï¸  Sample JMS Connection Properties:"
	@echo "   â€¢ Broker URL: tcp://localhost:61616"
	@echo "   â€¢ Username: admin"
	@echo "   â€¢ Password: admin"
	@echo "   â€¢ Connection Factory: ConnectionFactory"
	@echo ""
	@echo "ğŸ’¡ Queues are auto-created when first accessed"
	@echo "ğŸ’¡ Use the web console to monitor queues and messages"

# ğŸ§ª Run JMS demo script (placeholder for future implementation)
run-jms-demo:
	@echo "ğŸ§ª JMS Demo Script"
	@echo "ğŸ“ This target is ready for your JMS demo implementation"
	@echo "ğŸ’¡ Consider creating: test/suite/test_data/python_helper_files/jms_demo.py"
	@echo ""
	@echo "ğŸ”§ Connection details for your demo:"
	@echo "   â€¢ JMS URL: tcp://localhost:61616"
	@echo "   â€¢ Username: admin"
	@echo "   â€¢ Password: admin"
	@echo "   â€¢ Suggested queues: sap.idoc.queue, test.queue, demo.queue"
	@echo ""
	@echo "ğŸ“š Example libraries: pyjms, stomp.py, or py4j with ActiveMQ client"
