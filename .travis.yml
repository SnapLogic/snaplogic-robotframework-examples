version: "~> 1.0"

env:
  global:
    - HMD_HOME=$TRAVIS_BUILD_DIR

dist: jammy
group: stable
language: python
python:
  - 3.12

services:
  - docker

install: skip

before_script:
  - echo "ðŸ” Locating generated Cookiecutter project directory..."
  # Find the subdirectory that contains travis_scripts (which identifies your generated project)
  - export TEMPLATE_DIR=$(find . -maxdepth 2 -type d -name "travis_scripts" -exec dirname {} \; | head -n 1)
  - cd "$TEMPLATE_DIR"
  - chmod +x ./travis_scripts/setup_travis_env.sh
  - ./travis_scripts/setup_travis_env.sh

jobs:
  include:
    - stage: start-services
      script:
        - cd "$TEMPLATE_DIR"
        - export TRAVIS_COMMIT_AUTHOR_NAME="$(git log -1 --pretty=format:'%an' 2>/dev/null || echo 'CI Build')"
        - export TRAVIS_COMMIT_AUTHOR_EMAIL="$(git log -1 --pretty=format:'%ae')"
        - sudo service postgresql stop
        - chmod +x ./travis_scripts/debug_docker_build.sh
        - ./travis_scripts/debug_docker_build.sh
        - make start-services
        - make robot-run-all-tests TAGS="oracle sqlserver file_mount postgres_s3 sla_pipeline email2 snowflake_demo" PROJECT_SPACE_SETUP=True
        - make upload-test-results
        - make slack-notify
      name: Build Docs

notifications:
  slack:
    rooms:
      - secure: SlF5EB6bNzPqZZQtrPjDwfaBEV3qY9Tk1OzZqeguIDYZv6CFTe0nVrQUzbCHTnEyeaUc2RcfArRQmr5t0cQnjW5XuPy1WbD5igaoDI/jLY8lwnjIdliJvJnK11428+PQ6O0Q6cjyK7fX54dR2TIygHgr6Vx5yu+k8ONk78nWdSqwcpKI8ZzURHc5SUTV/LBAVfXg4gpuC4J0U6CZC+ttuGLkxlEhKVum7e8BELZns+EoJMkvMD/HiV14gsC77j3e0wT9nzGSOS/fxifVTVRiQn+QZbj7FNa9BJWsrQFbWyrZqtC+0xyZMtt8/ev1AVTETvXJtXYkJflYSuNCjEtCBBz9F36QvaTWMjB/chg+FmuOsxbnHm1D+ekRTrZ53Bzd4qikFX6RnBMyjMrFAwArf9mz7/RmVXUofjvPpC+JP3mQH1NItTEF09c5rvVyyzAFzqkBQPY3OSZeUM7UDE75NamB30GaTvqXqjwXQcdsjUWJuMu6TwAqUGuFARb9m/O0+SWWo/lM0IXT2JrK6r9S1JganSK0SHo9SttRkfXQtYlteXxA/Rou5VWO+auHlsiwjPTPjSQvII5rp8qampnI3LuaSH7RcRWwrzX3ktnhS5xG6eyLFD4P9kDP7v9YjLwo/iBzme+DFeTC1EbkhMSjawtDNjB7kooZgp9TkqTzRNA=
    on_success: always
    on_failure: always
