version: "~> 1.0"

# ===== ENVIRONMENT VARIABLES =====
env:
  global:
    # Build Configuration
    - HMD_HOME=$TRAVIS_BUILD_DIR
    - RELEASE_BUILD_VERSION="main-33084"

    # Oracle Database Configuration
    - ORACLE_ACCOUNT_NAME="oracle_acct"
    - ORACLE_HOST="oracle-db"
    - ORACLE_DBNAME="FREEPDB1"
    - ORACLE_DBPORT="1521"
    - ORACLE_DBUSER="SYSTEM"
    - ORACLE_DBPASS="Oracle123"

    # PostgreSQL Database Configuration
    - POSTGRES_ACCOUNT_NAME="postgres_acc"
    - POSTGRES_HOST="postgres-db"
    - POSTGRES_DBNAME="snaplogic"
    - POSTGRES_DBPORT="5432"
    - POSTGRES_DBUSER="snaplogic"
    - POSTGRES_DBPASS="snaplogic"

    # SQL Server Database Configuration
    - SQLSERVER_ACCOUNT_NAME="sqlserver_acct"
    - SQLSERVER_HOST="sqlserver-db"
    - SQLSERVER_DBNAME="TEST"
    - SQLSERVER_DBPORT="1433"
    - SQLSERVER_DBUSER="testuser"
    - SQLSERVER_DBPASS="Snaplogic123!"

    # MySQL Database Configuration
    - MYSQL_ACCOUNT_NAME="mysql_acct"
    - MYSQL_HOST="mysql-db"
    - MYSQL_DBNAME="TEST"
    - MYSQL_DBPORT="3306"
    - MYSQL_DBUSER="testuser"
    - MYSQL_DBPASS="snaplogic"
    - MYSQL_JAR="mysql-connector-j-9.3.0.jar"

    # DB2 Database Configuration
    - DB2_ACCOUNT_NAME="db2_acct"
    - DB2_HOST="db2-db"
    - DB2_DBNAME="TESTDB"
    - DB2_DBPORT="50000"
    - DB2_DBUSER="db2inst1"
    - DB2_DBPASS="snaplogic"
    - DB2_JDBC_JAR="../shared/db2jcc4.jar"
    - DB2_JDBC_DRIVER_CLASS="com.ibm.db2.jcc.DB2Driver"
    - DB2_JDBC_URL="jdbc:db2://host.docker.internal:50000/TESTDB"
    - DB2_TEST_QUERY="SELECT 1 FROM SYSIBM.SYSDUMMY1"

    # S3/MinIO Configuration
    - S3_ACCOUNT_NAME="s3_account"
    - S3_ENDPOINT="http://minio:9000"
    - S3_ACCESS_KEY="demouser"
    - S3_SECRET_KEY="demopassword"

    # JMS/ActiveMQ Configuration
    - JMS_ACCOUNT_NAME="jms_acct "
    - JMS_HOST="activemq"
    - JMS_PORT="61616"
    - JMS_USERNAME="admin"
    - JMS_PASSWORD="admin"
    - JMS_CONNECTION_FACTORY="ConnectionFactory"
    - JMS_INITIAL_CONTEXT_FACTORY="org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory"
    - JMS_PROVIDER_URL="tcp://activemq:61616"
    - JMS_QUEUE_NAME="demo.queue"

# ===== BUILD ENVIRONMENT =====
dist: jammy
group: stable
language: python
python:
  - 3.12

services:
  - docker

# ===== BUILD CONFIGURATION =====
install: skip

before_script:
  - "echo \"\U0001F50DEnvironment Variables set up and creating .env file:\""
  - chmod +x ./setup_env.sh
  - "./setup_env.sh"

# ===== JOBS =====
jobs:
  include:
    - stage: start-services
      script:
        #  Export Travis environment variables to be used by docker-compose
        - export TRAVIS_COMMIT_AUTHOR_NAME="$(git log -1 --pretty=format:'%an' 2>/dev/null || echo 'CI Build')"
        - export TRAVIS_COMMIT_AUTHOR_EMAIL="$(git log -1 --pretty=format:'%ae')"
        - make snaplogic-start-services
        - make robot-run-all-tests TAGS="oracle sqlserver file_mount postgres_s3 sla snowflake_intuit" PROJECT_SPACE_SETUP=True
        - make upload-test-results
        - make slack-notify

      name: Build Docs

# ===== NOTIFICATIONS =====
notifications:
  slack:
    rooms:
      - secure: SlF5EB6bNzPqZZQtrPjDwfaBEV3qY9Tk1OzZqeguIDYZv6CFTe0nVrQUzbCHTnEyeaUc2RcfArRQmr5t0cQnjW5XuPy1WbD5igaoDI/jLY8lwnjIdliJvJnK11428+PQ6O0Q6cjyK7fX54dR2TIygHgr6Vx5yu+k8ONk78nWdSqwcpKI8ZzURHc5SUTV/LBAVfXg4gpuC4J0U6CZC+ttuGLkxlEhKVum7e8BELZns+EoJMkvMD/HiV14gsC77j3e0wT9nzGSOS/fxifVTVRiQn+QZbj7FNa9BJWsrQFbWyrZqtC+0xyZMtt8/ev1AVTETvXJtXYkJflYSuNCjEtCBBz9F36QvaTWMjB/chg+FmuOsxbnHm1D+ekRTrZ53Bzd4qikFX6RnBMyjMrFAwArf9mz7/RmVXUofjvPpC+JP3mQH1NItTEF09c5rvVyyzAFzqkBQPY3OSZeUM7UDE75NamB30GaTvqXqjwXQcdsjUWJuMu6TwAqUGuFARb9m/O0+SWWo/lM0IXT2JrK6r9S1JganSK0SHo9SttRkfXQtYlteXxA/Rou5VWO+auHlsiwjPTPjSQvII5rp8qampnI3LuaSH7RcRWwrzX3ktnhS5xG6eyLFD4P9kDP7v9YjLwo/iBzme+DFeTC1EbkhMSjawtDNjB7kooZgp9TkqTzRNA=
    on_success: always
    on_failure: always
