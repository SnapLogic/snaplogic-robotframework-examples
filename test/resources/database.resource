*** Settings ***
Documentation       Resource file for Database operations and management
...                 Contains all keywords related to:
...                 â€¢ Database connection management (PostgreSQL, Oracle, etc.)
...                 â€¢ SQL script execution and management
...                 â€¢ Query execution and result processing
...                 â€¢ Table creation and management
...                 â€¢ Data counting and validation operations
...                 â€¢ Database utility functions

# Standard Libraries for database operations
Library             OperatingSystem    # File system operations for SQL scripts
Library             DatabaseLibrary    # Generic database operations
Library             psycopg2    # PostgreSQL driver
Library             String    # String operations for SQL processing
Library             Collections    # List and dictionary operations


*** Keywords ***
################## DATABASE CONNECTION MANAGEMENT ##################

Connect to Postgres Database
    [Documentation]    Establishes connection to PostgreSQL database using psycopg2 driver
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database connection is successfully established
    ...    â€¢ PostgreSQL server is accessible at specified host and port
    ...    â€¢ Database credentials are valid and authenticated
    ...    â€¢ Database name exists and is accessible
    ...    â€¢ Connection is ready for SQL operations
    [Arguments]
    ...    ${POSTGRES_DBNAME}
    ...    ${POSTGRES_DBUSER}
    ...    ${POSTGRES_DBPASS}
    ...    ${POSTGRES_HOST}
    ...    ${POSTGRES_DBPORT}=5432

    Log    ğŸ”Œ Connecting to PostgreSQL database...
    Log    ğŸ“Š Host: ${POSTGRES_HOST}:${POSTGRES_DBPORT}
    Log    ğŸ›ï¸ Database: ${POSTGRES_DBNAME}
    Log    ğŸ‘¤ User: ${POSTGRES_DBUSER}

    Connect To Database
    ...    psycopg2
    ...    ${POSTGRES_DBNAME}
    ...    ${POSTGRES_DBUSER}
    ...    ${POSTGRES_DBPASS}
    ...    ${POSTGRES_HOST}
    ...    ${POSTGRES_DBPORT}

    Log    âœ… Successfully connected to PostgreSQL database

Connect to Oracle Database
    [Documentation]    Sets up Oracle database connection
    ...    *Arguments:*
    ...    - None (uses environment variables for connection)
    ...    *Example:*
    ...    | Connect to Oracle Database |
    [Arguments]    ${ORACLE_DBNAME}    ${ORACLE_DBUSER}    ${ORACLE_DBPASS}    ${ORACLE_HOST}    ${ORACLE_DBPORT}

    Connect To Database
    ...    oracledb
    ...    ${ORACLE_DBNAME}
    ...    ${ORACLE_DBUSER}
    ...    ${ORACLE_DBPASS}
    ...    ${ORACLE_HOST}
    ...    ${ORACLE_DBPORT}

    Log    âœ… Successfully connected to Oracle database

Connect to Database Generic
    [Documentation]    Generic database connection supporting multiple database types
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database driver module is available and can be imported
    ...    â€¢ Database server is accessible at specified host and port
    ...    â€¢ Database credentials are valid and authenticated
    ...    â€¢ Database name exists and is accessible
    ...    â€¢ Connection is ready for SQL operations
    [Arguments]    ${db_module}    ${db_name}    ${db_user}    ${db_pass}    ${db_host}    ${db_port}

    Log    ğŸ”Œ Connecting to ${db_module} database...
    Log    ğŸ“Š Host: ${db_host}:${db_port}
    Log    ğŸ›ï¸ Database: ${db_name}
    Log    ğŸ‘¤ User: ${db_user}

    Connect To Database
    ...    ${db_module}
    ...    ${db_name}
    ...    ${db_user}
    ...    ${db_pass}
    ...    ${db_host}
    ...    ${db_port}

    Log    âœ… Successfully connected to ${db_module} database

Disconnect from Database
    [Documentation]    Safely disconnects from current database
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database connection is properly closed
    ...    â€¢ No hanging connections or resource leaks
    ...    â€¢ Connection cleanup is completed successfully

    Log    ğŸ”Œ Disconnecting from database...
    Disconnect From Database
    Log    âœ… Successfully disconnected from database

Test Database Connection
    [Documentation]    Tests database connection with a simple query
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database connection is active and responsive
    ...    â€¢ Simple query executes successfully
    ...    â€¢ Database server is functioning properly
    [Arguments]    ${test_query}=SELECT 1

    Log    ğŸ” Testing database connection...

    TRY
        ${result}=    Query    ${test_query}
        Log    âœ… Database connection test passed
        Log    ğŸ“Š Test query result: ${result}
        RETURN    ${TRUE}
    EXCEPT    AS    ${error}
        Log    âŒ Database connection test failed: ${error}
        RETURN    ${FALSE}
    END

################## SQL EXECUTION AND MANAGEMENT ##################

Execute SQL String Safe
    [Documentation]    Safely executes SQL string with error handling
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL statement is properly formatted and valid
    ...    â€¢ SQL execution completes without syntax errors
    ...    â€¢ Database permissions allow the operation
    ...    â€¢ Transaction is properly committed or rolled back
    [Arguments]    ${sql_statement}

    Log    ğŸ“ Executing SQL statement...
    Log    ğŸ” SQL: ${sql_statement}

    TRY
        Execute SQL String    ${sql_statement}
        Log    âœ… SQL statement executed successfully
    EXCEPT    AS    ${error}
        Log    âŒ SQL execution failed: ${error}
        Fail    SQL execution failed: ${error}
    END

Execute SQL Script From File
    [Documentation]    Executes SQL statements from a script file
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL script file exists and is readable
    ...    â€¢ All SQL statements in file are valid and execute successfully
    ...    â€¢ Comments and empty lines are properly handled
    ...    â€¢ File parsing completes without errors
    ...    â€¢ All statements are executed in sequence
    [Arguments]    ${script_path}

    # Verify script file exists
    File Should Exist    ${script_path}

    # Read the SQL script
    ${sql_content}=    Get File    ${script_path}
    Log    ğŸ“„ Executing SQL script: ${script_path}

    # Split the script into individual statements
    ${sql_statements}=    Split SQL Script Content    ${sql_content}

    # Execute each statement
    ${executed_count}=    Set Variable    0
    FOR    ${statement}    IN    @{sql_statements}
        ${trimmed_statement}=    Strip String    ${statement}
        IF    '${trimmed_statement}' != '' and not '${trimmed_statement}'.startswith('--')
            Log    ğŸ” Executing: ${trimmed_statement}
            Execute SQL String Safe    ${trimmed_statement}
            ${executed_count}=    Evaluate    ${executed_count} + 1
        END
    END

    Log    âœ… SQL script executed successfully (${executed_count} statements)

Split SQL Script Content
    [Documentation]    Splits SQL script content into individual executable statements
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL content is properly parsed and split
    ...    â€¢ Comments and empty lines are filtered out
    ...    â€¢ Each statement is properly formatted for execution
    ...    â€¢ Statement separation by semicolons works correctly
    [Arguments]    ${sql_content}

    # Remove comments and split by semicolon
    ${lines}=    Split To Lines    ${sql_content}
    ${cleaned_lines}=    Create List

    FOR    ${line}    IN    @{lines}
        ${trimmed_line}=    Strip String    ${line}
        IF    not '${trimmed_line}'.startswith('--') and '${trimmed_line}' != ''
            Append To List    ${cleaned_lines}    ${trimmed_line}
        END
    END

    ${cleaned_sql}=    Catenate    SEPARATOR= ${SPACE}    @{cleaned_lines}
    ${statements}=    Split String    ${cleaned_sql}    ;

    # Filter out empty statements
    ${filtered_statements}=    Create List
    FOR    ${stmt}    IN    @{statements}
        ${trimmed_stmt}=    Strip String    ${stmt}
        IF    '${trimmed_stmt}' != ''
            Append To List    ${filtered_statements}    ${trimmed_stmt}
        END
    END

    Log    ğŸ“Š Split SQL script into ${filtered_statements.__len__()} statements
    RETURN    ${filtered_statements}

################## QUERY EXECUTION AND RESULT PROCESSING ##################

Execute SQL Query And Get Count
    [Documentation]    Executes a COUNT query and returns the result as integer
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL query executes successfully
    ...    â€¢ Query returns a valid numeric result
    ...    â€¢ Result can be converted to integer
    ...    â€¢ Query syntax is valid for COUNT operations
    [Arguments]    ${sql_query}

    Log    ğŸ” Executing count query: ${sql_query}

    ${result}=    Query    ${sql_query}
    ${count_row}=    Get From List    ${result}    0
    ${count_value}=    Get From List    ${count_row}    0

    Log    ğŸ“Š Count query result: ${count_value}
    RETURN    ${count_value}

Execute SQL Query And Get Results
    [Documentation]    Executes SQL query and returns all results
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL query executes successfully
    ...    â€¢ Results are properly formatted and returned
    ...    â€¢ Query syntax is valid
    ...    â€¢ Database permissions allow the query
    [Arguments]    ${sql_query}    ${fetch_all}=${TRUE}

    Log    ğŸ” Executing query: ${sql_query}

    TRY
        IF    ${fetch_all}
            ${results}=    Query    ${sql_query}
        ELSE
            ${results}=    Query    ${sql_query}    returnAsDict=${TRUE}
        END

        ${row_count}=    Get Length    ${results}
        Log    ğŸ“Š Query returned ${row_count} rows
        RETURN    ${results}
    EXCEPT    AS    ${error}
        Log    âŒ Query execution failed: ${error}
        Fail    Query execution failed: ${error}
    END

Execute SQL Query And Get Single Value
    [Documentation]    Executes SQL query and returns single scalar value
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL query executes successfully
    ...    â€¢ Query returns exactly one row and one column
    ...    â€¢ Result can be extracted as single value
    ...    â€¢ Query is designed for single value return
    [Arguments]    ${sql_query}

    Log    ğŸ” Executing single value query: ${sql_query}

    ${results}=    Query    ${sql_query}
    ${row_count}=    Get Length    ${results}

    Should Be Equal As Numbers    ${row_count}    1
    ...    Query should return exactly 1 row, but returned ${row_count}

    ${first_row}=    Get From List    ${results}    0
    ${value}=    Get From List    ${first_row}    0

    Log    ğŸ“Š Single value result: ${value}
    RETURN    ${value}

Check If Table Exists
    [Documentation]    Checks if a table exists in the database
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database connection is active
    ...    â€¢ Table existence query executes successfully
    ...    â€¢ Returns accurate boolean result
    [Arguments]    ${table_name}    ${schema}=public

    ${query}=    Set Variable
    ...    SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='${schema}' AND table_name='${table_name}'

    ${count}=    Execute SQL Query And Get Count    ${query}
    ${exists}=    Evaluate    ${count} > 0

    IF    ${exists}
        Log    âœ… Table '${table_name}' exists in schema '${schema}'
    ELSE
        Log    âŒ Table '${table_name}' does not exist in schema '${schema}'
    END

    RETURN    ${exists}

Get Table Row Count
    [Documentation]    Gets the total number of rows in a table
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists in the database
    ...    â€¢ COUNT query executes successfully
    ...    â€¢ Returns accurate row count as integer
    [Arguments]    ${table_name}

    ${query}=    Set Variable    SELECT COUNT(*) FROM ${table_name}
    ${count}=    Execute SQL Query And Get Count    ${query}

    Log    ğŸ“Š Table '${table_name}' contains ${count} rows
    RETURN    ${count}

################## TABLE MANAGEMENT OPERATIONS ##################

Create Table From Template
    [Documentation]    Creates table using SQL from template or direct SQL statement
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ SQL statement is valid CREATE TABLE syntax
    ...    â€¢ Table creation executes successfully
    ...    â€¢ Table is created with proper schema and constraints
    ...    â€¢ No SQL syntax or permission errors occur
    [Arguments]    ${sql_query}

    Log    ğŸ—ï¸ Creating table from template...
    Log    ğŸ“ SQL: ${sql_query}

    Execute SQL String Safe    ${sql_query}
    Log    âœ… Table created successfully

Drop Table If Exists
    [Documentation]    Safely drops a table if it exists
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ DROP TABLE operation completes successfully
    ...    â€¢ No errors if table doesn't exist
    ...    â€¢ Table and all its data are removed
    [Arguments]    ${table_name}    ${cascade}=${FALSE}

    Log    ğŸ—‘ï¸ Dropping table if exists: ${table_name}

    ${cascade_clause}=    Set Variable If    ${cascade}    CASCADE    ${EMPTY}
    ${sql}=    Set Variable    DROP TABLE IF EXISTS ${table_name} ${cascade_clause}

    Execute SQL String Safe    ${sql}
    Log    âœ… Table '${table_name}' dropped successfully

Truncate Table
    [Documentation]    Truncates (empties) a table
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists before truncation
    ...    â€¢ TRUNCATE operation completes successfully
    ...    â€¢ All data is removed from table
    ...    â€¢ Table structure remains intact
    [Arguments]    ${table_name}

    Log    ğŸ—‘ï¸ Truncating table: ${table_name}

    ${sql}=    Set Variable    TRUNCATE TABLE ${table_name}
    Execute SQL String Safe    ${sql}

    Log    âœ… Table '${table_name}' truncated successfully

Get Table Columns
    [Documentation]    Gets column names from database table
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists in the database
    ...    â€¢ Column metadata query executes successfully
    ...    â€¢ Returns list of column names
    ...    â€¢ Column information is accurate and current
    [Arguments]    ${table_name}    ${schema}=public    ${exclude_id}=${TRUE}

    Log    ğŸ” Getting columns for table: ${table_name}

    ${id_filter}=    Set Variable If    ${exclude_id}    AND column_name != 'id'    ${EMPTY}

    ${query}=    Set Variable
    ...    SELECT column_name FROM information_schema.columns WHERE table_schema='${schema}' AND table_name='${table_name}' ${id_filter} ORDER BY ordinal_position

    ${result}=    Query    ${query}

    ${columns}=    Create List
    FOR    ${row}    IN    @{result}
        ${column}=    Get From List    ${row}    0
        Append To List    ${columns}    ${column}
    END

    Log    ğŸ“Š Table '${table_name}' columns: ${columns}
    RETURN    ${columns}

Get Table Schema Info
    [Documentation]    Gets detailed schema information for a table
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists in the database
    ...    â€¢ Schema query executes successfully
    ...    â€¢ Returns comprehensive table metadata
    ...    â€¢ Column details are accurate and complete
    [Arguments]    ${table_name}    ${schema}=public

    Log    ğŸ” Getting schema info for table: ${table_name}

    ${query}=    Set Variable
    ...    SELECT column_name, data_type, is_nullable, column_default, character_maximum_length
    ...    FROM information_schema.columns
    ...    WHERE table_schema='${schema}' AND table_name='${table_name}'
    ...    ORDER BY ordinal_position

    ${results}=    Execute SQL Query And Get Results    ${query}

    Log    ğŸ“Š Schema info for '${table_name}': ${results.__len__()} columns
    RETURN    ${results}

################## DATA VALIDATION AND COUNTING ##################

Validate Table Data Count
    [Documentation]    Validates that table contains expected number of rows
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists and is accessible
    ...    â€¢ Actual row count matches expected count exactly
    ...    â€¢ COUNT query executes successfully
    [Arguments]    ${table_name}    ${expected_count}

    Log    ğŸ” Validating data count for table: ${table_name}
    Log    ğŸ“Š Expected count: ${expected_count}

    ${actual_count}=    Get Table Row Count    ${table_name}

    Should Be Equal As Numbers    ${actual_count}    ${expected_count}
    ...    Table '${table_name}' has ${actual_count} rows, expected ${expected_count}

    Log    âœ… Table data count validation passed: ${actual_count} rows

Compare Table Row Counts
    [Documentation]    Compares row counts between two tables
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Both tables exist and are accessible
    ...    â€¢ Row count queries execute successfully
    ...    â€¢ Comparison logic works correctly
    [Arguments]    ${table1}    ${table2}    ${should_match}=${TRUE}

    Log    ğŸ” Comparing row counts between tables...
    Log    ğŸ“Š Table 1: ${table1}
    Log    ğŸ“Š Table 2: ${table2}

    ${count1}=    Get Table Row Count    ${table1}
    ${count2}=    Get Table Row Count    ${table2}

    Log    ğŸ“Š ${table1}: ${count1} rows
    Log    ğŸ“Š ${table2}: ${count2} rows

    IF    ${should_match}
        Should Be Equal As Numbers    ${count1}    ${count2}
        ...    Table row counts don't match: ${table1}(${count1}) != ${table2}(${count2})
        Log    âœ… Table row counts match: ${count1} rows each
    ELSE
        Should Not Be Equal As Numbers    ${count1}    ${count2}
        ...    Table row counts should not match but both have ${count1} rows
        Log    âœ… Table row counts differ as expected: ${count1} vs ${count2}
    END

Validate Table Has Data
    [Documentation]    Validates that table contains at least one row
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists and is accessible
    ...    â€¢ Table contains at least one row of data
    ...    â€¢ COUNT query executes successfully
    [Arguments]    ${table_name}

    Log    ğŸ” Validating table has data: ${table_name}

    ${count}=    Get Table Row Count    ${table_name}

    Should Be True    ${count} > 0
    ...    Table '${table_name}' is empty (0 rows)

    Log    âœ… Table '${table_name}' contains data: ${count} rows

Validate Table Is Empty
    [Documentation]    Validates that table is empty (0 rows)
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Table exists and is accessible
    ...    â€¢ Table contains exactly 0 rows
    ...    â€¢ COUNT query executes successfully
    [Arguments]    ${table_name}

    Log    ğŸ” Validating table is empty: ${table_name}

    ${count}=    Get Table Row Count    ${table_name}

    Should Be Equal As Numbers    ${count}    0
    ...    Table '${table_name}' is not empty (${count} rows)

    Log    âœ… Table '${table_name}' is empty as expected

################## TRANSACTION MANAGEMENT ##################

Begin Transaction
    [Documentation]    Begins a database transaction
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database connection supports transactions
    ...    â€¢ Transaction begins successfully
    ...    â€¢ Transaction state is properly managed

    Log    ğŸ”„ Beginning database transaction...
    Execute SQL String    BEGIN
    Log    âœ… Transaction started successfully

Commit Transaction
    [Documentation]    Commits current database transaction
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Active transaction exists
    ...    â€¢ Transaction commits successfully
    ...    â€¢ All changes are persisted to database

    Log    ğŸ’¾ Committing database transaction...
    Execute SQL String    COMMIT
    Log    âœ… Transaction committed successfully

Rollback Transaction
    [Documentation]    Rolls back current database transaction
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Active transaction exists
    ...    â€¢ Transaction rollback completes successfully
    ...    â€¢ All changes are discarded

    Log    â†©ï¸ Rolling back database transaction...
    Execute SQL String    ROLLBACK
    Log    âœ… Transaction rolled back successfully

Execute SQL With Transaction
    [Documentation]    Executes SQL statements within a transaction with automatic rollback on error
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Transaction management works correctly
    ...    â€¢ SQL statements execute successfully or transaction is rolled back
    ...    â€¢ Database state is consistent after operation
    [Arguments]    ${sql_statements}    ${auto_commit}=${TRUE}

    Log    ğŸ”„ Executing SQL with transaction management...

    TRY
        Begin Transaction

        # Handle both single statement and list of statements
        ${is_list}=    Evaluate    isinstance($sql_statements, list)

        IF    ${is_list}
            FOR    ${statement}    IN    @{sql_statements}
                Execute SQL String Safe    ${statement}
            END
        ELSE
            Execute SQL String Safe    ${sql_statements}
        END

        IF    ${auto_commit}
            Commit Transaction
            Log    âœ… SQL executed and committed successfully
        ELSE
            Log    âœ… SQL executed successfully (transaction not committed)
        END
    EXCEPT    AS    ${error}
        Log    âŒ SQL execution failed, rolling back transaction: ${error}
        Rollback Transaction
        Fail    SQL execution failed: ${error}
    END

################## DATABASE UTILITY KEYWORDS ##################

Wait For Database Connection
    [Documentation]    Waits for database to become available with retry logic
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Database eventually becomes available within timeout
    ...    â€¢ Connection test succeeds at least once
    ...    â€¢ Retry logic works correctly
    [Arguments]    ${timeout}=30s    ${retry_interval}=2s

    Log    â³ Waiting for database connection (timeout: ${timeout})...

    ${end_time}=    Add Time To Date    ${NOW}    ${timeout}

    WHILE    True
        ${current_time}=    Get Current Date
        ${time_exceeded}=    Evaluate    '${current_time}' > '${end_time}'

        IF    ${time_exceeded}
            Fail    Database connection timeout after ${timeout}
        END

        ${connected}=    Test Database Connection
        IF    ${connected}
            Log    âœ… Database connection established
            BREAK
        END

        Log    â³ Database not ready, retrying in ${retry_interval}...
        Sleep    ${retry_interval}
    END

Execute SQL Template
    [Documentation]    Executes SQL with variable substitution from template
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Template variables are properly substituted
    ...    â€¢ Resulting SQL is valid and executes successfully
    ...    â€¢ Variable substitution works correctly
    [Arguments]    ${sql_template}    &{variables}

    Log    ğŸ“ Executing SQL template with variables...
    Log    ğŸ”§ Variables: ${variables}

    # Substitute variables in SQL template
    ${sql_with_vars}=    Set Variable    ${sql_template}
    FOR    ${var_name}    ${var_value}    IN    &{variables}
        ${sql_with_vars}=    Replace String    ${sql_with_vars}    {${var_name}}    ${var_value}
    END

    Log    ğŸ“ Final SQL: ${sql_with_vars}
    Execute SQL String Safe    ${sql_with_vars}
    Log    âœ… SQL template executed successfully

Backup Table Data
    [Documentation]    Creates a backup of table data (simplified version)
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Source table exists and is accessible
    ...    â€¢ Backup table is created successfully
    ...    â€¢ All data is copied correctly
    [Arguments]    ${source_table}    ${backup_table}    ${drop_if_exists}=${TRUE}

    Log    ğŸ’¾ Creating backup of table: ${source_table} â†’ ${backup_table}

    IF    ${drop_if_exists}    Drop Table If Exists    ${backup_table}

    ${sql}=    Set Variable    CREATE TABLE ${backup_table} AS SELECT * FROM ${source_table}
    Execute SQL String Safe    ${sql}

    # Verify backup
    ${source_count}=    Get Table Row Count    ${source_table}
    ${backup_count}=    Get Table Row Count    ${backup_table}

    Should Be Equal As Numbers    ${source_count}    ${backup_count}
    ...    Backup failed: source has ${source_count} rows, backup has ${backup_count}

    Log    âœ… Table backup completed: ${backup_count} rows copied

Clean Database Tables
    [Documentation]    Cleans up test tables by truncating or dropping them
    ...    ğŸ“‹ ASSERTIONS:
    ...    â€¢ Cleanup operations complete successfully
    ...    â€¢ Tables are properly removed or emptied
    ...    â€¢ No errors during cleanup process
    [Arguments]    ${tables}    ${operation}=TRUNCATE

    Log    ğŸ§¹ Cleaning database tables (${operation})...
    Log    ğŸ“‹ Tables: ${tables}

    # Handle both single table and list of tables
    ${is_list}=    Evaluate    isinstance($tables, list)
    ${table_list}=    Set Variable If    ${is_list}    ${tables}    [${tables}]

    FOR    ${table}    IN    @{table_list}
        TRY
            IF    '${operation}' == 'TRUNCATE'
                Truncate Table    ${table}
            ELSE IF    '${operation}' == 'DROP'
                Drop Table If Exists    ${table}
            ELSE
                Log    âš ï¸ Unknown operation: ${operation}, skipping table ${table}
            END
        EXCEPT    AS    ${error}
            Log    âš ï¸ Failed to clean table ${table}: ${error}
        END
    END

    Log    âœ… Database cleanup completed
