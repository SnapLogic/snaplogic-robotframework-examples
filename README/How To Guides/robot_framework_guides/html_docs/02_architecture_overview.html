<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Overview - SnapLogic Robot Framework</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6; color: #333; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 10px; font-size: 2.5em; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1em; }
        h2 { color: #34495e; border-bottom: 3px solid #2980b9; padding-bottom: 10px; margin-top: 30px; margin-bottom: 20px; }
        h3 { color: #2980b9; margin-top: 25px; margin-bottom: 15px; }
        p { margin-bottom: 15px; }
        .card { background: #f8f9fa; border-radius: 8px; padding: 25px; margin: 20px 0; border-left: 4px solid #2980b9; }
        .highlight-box { background: linear-gradient(135deg, #2980b9 0%, #2c3e50 100%); color: white; padding: 25px; border-radius: 12px; margin: 20px 0; }
        .highlight-box h3 { color: white; margin-top: 0; }
        code { background: #e9ecef; padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .code-box { background: #2c3e50; color: #ecf0f1; padding: 15px 20px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 15px 0; overflow-x: auto; font-size: 0.9em; }
        .code-box pre { margin: 0; font-family: 'Courier New', monospace; white-space: pre; color: inherit; }
        .code-box .comment { color: #95a5a6; }
        .code-box .keyword { color: #e74c3c; }
        .code-box .string { color: #2ecc71; }
        .code-box .variable { color: #f39c12; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #2980b9; color: white; }
        tr:nth-child(even) { background: #f8f9fa; }
        tr:hover { background: #e9ecef; }
        .toc { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
        .toc h3 { margin-top: 0; color: #495057; }
        .toc ul { list-style-type: none; padding-left: 0; }
        .toc li { margin: 8px 0; }
        .toc a { color: #2980b9; text-decoration: none; }
        .toc a:hover { text-decoration: underline; }
        .info { background: #d1ecf1; border: 1px solid #17a2b8; border-left: 4px solid #17a2b8; padding: 15px; border-radius: 0 5px 5px 0; margin: 15px 0; }
        .success { background: #d4edda; border: 1px solid #28a745; border-left: 4px solid #28a745; padding: 15px; border-radius: 0 5px 5px 0; margin: 15px 0; }
        .flow-diagram { background: #1a252f; color: #ecf0f1; padding: 25px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.85em; overflow-x: auto; margin: 20px 0; }
        .flow-diagram pre { margin: 0; white-space: pre; }
        .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        @media (max-width: 768px) { .two-column { grid-template-columns: 1fr; } }
        .service-card { background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 10px 0; }
        .service-card h4 { margin-top: 0; color: #2c3e50; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.8em; font-weight: bold; margin-right: 5px; }
        .badge-db { background: #e74c3c; color: white; }
        .badge-mock { background: #9b59b6; color: white; }
        .badge-msg { background: #f39c12; color: white; }
        .badge-core { background: #27ae60; color: white; }
        ul, ol { margin-left: 20px; margin-bottom: 15px; }
        li { margin: 8px 0; }
        .nav-links { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; }
        .nav-links a { color: #2980b9; text-decoration: none; font-weight: 600; }
        .nav-links a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>02 - Architecture Overview</h1>
        <p class="subtitle">Understanding the Testing Architecture: CI/CD, Robot Framework, Docker & SnapLogic Platform</p>

        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#high-level">1. High-Level Architecture</a></li>
                <li><a href="#four-layers">2. The Four Layers</a></li>
                <li><a href="#docker-infrastructure">3. Docker Infrastructure</a></li>
                <li><a href="#makefile-architecture">4. Modular Makefile Architecture</a></li>
                <li><a href="#test-execution-flow">5. Test Execution Flow</a></li>
                <li><a href="#env-flow">6. Environment Variable Flow</a></li>
            </ul>
        </div>

        <!-- Section 1: High-Level Architecture -->
        <div id="high-level" class="card">
            <h2>1. High-Level Architecture</h2>
            <p>The SnapLogic Robot Framework is a multi-layered test automation system that orchestrates Docker containers, SnapLogic platform APIs, and Robot Framework tests through a unified Makefile interface.</p>

            <div class="flow-diagram">
<pre>
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                        ARCHITECTURE OVERVIEW                             │
    ├─────────────────────────────────────────────────────────────────────────┤
    │                                                                         │
    │  ┌─────────────────────────────────────────────────────────────────┐   │
    │  │  LAYER 1: COMMAND INTERFACE                                      │   │
    │  │  Makefile Targets (make robot-run-all-tests, make start-services)│   │
    │  └──────────────────────────────┬──────────────────────────────────┘   │
    │                                 │                                       │
    │  ┌──────────────────────────────▼──────────────────────────────────┐   │
    │  │  LAYER 2: DOCKER INFRASTRUCTURE                                  │   │
    │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │   │
    │  │  │  Oracle   │ │ Postgres │ │  Kafka   │ │  MinIO   │   ...    │   │
    │  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │   │
    │  │  ┌────────────────────────┐ ┌────────────────────────┐         │   │
    │  │  │   Tools Container      │ │   Groundplex Container │         │   │
    │  │  │   (Robot Framework)    │ │   (SnapLogic Runtime)  │         │   │
    │  │  └────────────────────────┘ └────────────────────────┘         │   │
    │  └──────────────────────────────┬──────────────────────────────────┘   │
    │                                 │                                       │
    │  ┌──────────────────────────────▼──────────────────────────────────┐   │
    │  │  LAYER 3: TEST LAYER                                             │   │
    │  │  Robot Framework (.robot files, keywords, resources, libraries)  │   │
    │  └──────────────────────────────┬──────────────────────────────────┘   │
    │                                 │                                       │
    │  ┌──────────────────────────────▼──────────────────────────────────┐   │
    │  │  LAYER 4: SNAPLOGIC PLATFORM                                     │   │
    │  │  REST APIs (Accounts, Pipelines, Tasks, Execution, Monitoring)  │   │
    │  └─────────────────────────────────────────────────────────────────┘   │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
</pre>
            </div>
        </div>

        <!-- Section 2: Four Layers -->
        <div id="four-layers" class="card">
            <h2>2. The Four Layers</h2>

            <h3>Layer 1: Command Interface (Makefiles)</h3>
            <p>Simple commands that abstract all complexity. Users only interact with <code>make</code> commands.</p>
            <div class="code-box">
<pre><span class="comment"># Examples of user-facing commands</span>
make start-services                                    <span class="comment"># Start all Docker services</span>
make robot-run-all-tests TAGS="oracle"                 <span class="comment"># Run Oracle tests end-to-end</span>
make robot-run-tests-no-gp TAGS="postgres_demo"        <span class="comment"># Run tests without Groundplex</span>
make status                                            <span class="comment"># Check all running services</span>
make oracle-start                                      <span class="comment"># Start just Oracle</span>
make postgres-load-data                                <span class="comment"># Load test data into Postgres</span></pre>
            </div>

            <h3>Layer 2: Docker Infrastructure</h3>
            <p>All services run as Docker containers on a shared <code>snaplogicnet</code> bridge network:</p>

            <div class="two-column">
                <div class="service-card">
                    <h4><span class="badge badge-db">Databases</span></h4>
                    <ul>
                        <li>Oracle Database (port 1521)</li>
                        <li>PostgreSQL (port 5432)</li>
                        <li>MySQL (port 3306)</li>
                        <li>SQL Server (port 1433)</li>
                        <li>DB2, Teradata</li>
                    </ul>
                </div>
                <div class="service-card">
                    <h4><span class="badge badge-mock">Mock Services</span></h4>
                    <ul>
                        <li>MinIO - S3 emulation (port 9000)</li>
                        <li>Salesforce Mock via WireMock (port 8089)</li>
                        <li>MailDev - Email mock (port 1080)</li>
                    </ul>
                </div>
                <div class="service-card">
                    <h4><span class="badge badge-msg">Messaging</span></h4>
                    <ul>
                        <li>Apache Kafka (port 9092)</li>
                        <li>ActiveMQ / Artemis (port 8161)</li>
                        <li>Kafka UI for monitoring (port 8080)</li>
                    </ul>
                </div>
                <div class="service-card">
                    <h4><span class="badge badge-core">Core</span></h4>
                    <ul>
                        <li>Tools Container (Python 3.12 + Robot Framework)</li>
                        <li>Groundplex Container (SnapLogic Runtime)</li>
                        <li>All on <code>snaplogicnet</code> network</li>
                    </ul>
                </div>
            </div>

            <h3>Layer 3: Test Layer (Robot Framework)</h3>
            <p>Keyword-driven tests that are readable by anyone:</p>
            <div class="code-box">
<pre><span class="keyword">*** Test Cases ***</span>
Create Postgres Account
    [Tags]    postgres_demo    account
    [Template]    Create Account From Template
    ${ACCOUNT_LOCATION_PATH}    ${POSTGRES_PAYLOAD_FILE}    ${POSTGRES_ACCOUNT_NAME}

Import Pipeline
    [Tags]    postgres_demo    pipeline
    [Template]    Import Pipelines From Template
    ${unique_id}    ${PIPELINES_LOCATION_PATH}    ${pipeline_name}    ${pipeline_file}

Execute Pipeline and Verify
    [Tags]    postgres_demo    execution
    [Template]    Run Triggered Task With Parameters From Template
    ${unique_id}    ${PIPELINES_LOCATION_PATH}    ${pipeline_name}    ${task_name}</pre>
            </div>

            <h3>Layer 4: SnapLogic Platform</h3>
            <p>The framework communicates with SnapLogic via REST APIs through the <code>snaplogic-common-robot</code> library:</p>
            <table>
                <thead>
                    <tr><th>API Operation</th><th>Robot Keyword</th><th>Purpose</th></tr>
                </thead>
                <tbody>
                    <tr><td>Account Management</td><td><code>Create Account From Template</code></td><td>Create database/service credentials</td></tr>
                    <tr><td>Pipeline Import</td><td><code>Import Pipelines From Template</code></td><td>Upload .slp pipeline files</td></tr>
                    <tr><td>Task Management</td><td><code>Create Triggered Task From Template</code></td><td>Create on-demand execution endpoints</td></tr>
                    <tr><td>Task Execution</td><td><code>Run Triggered Task With Parameters</code></td><td>Execute pipelines with parameters</td></tr>
                    <tr><td>Project Space</td><td><code>Set Up Data</code></td><td>Create/delete project spaces</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Section 3: Docker Infrastructure -->
        <div id="docker-infrastructure" class="card">
            <h2>3. Docker Infrastructure</h2>
            <p>The <code>docker-compose.yml</code> aggregates 10+ separate compose files using Docker Compose <code>include</code>:</p>

            <div class="code-box">
<pre><span class="comment"># docker-compose.yml - Master orchestrator</span>
include:
  - docker/oracle/docker-compose.oracle.yml
  - docker/groundplex/docker-compose.groundplex.yml
  - docker/postgres/docker-compose.postgres.yml
  - docker/mysql/docker-compose.mysql.yml
  - docker/sqlserver/docker-compose.sqlserver.yml
  - docker/db2/docker-compose.db2.yml
  - docker/kafka/docker-compose.kafka.yml
  - docker/email/docker-compose.email-mock.yml
  - docker/salesforce/docker-compose.salesforce-mock.yml
  - docker/minio/docker-compose.s3emulator.yml</pre>
            </div>

            <h3>The Tools Container</h3>
            <p>The central test runner that executes Robot Framework:</p>
            <table>
                <thead>
                    <tr><th>Property</th><th>Value</th></tr>
                </thead>
                <tbody>
                    <tr><td>Base Image</td><td><code>python:3.12.7-slim-bookworm</code></td></tr>
                    <tr><td>Container Name</td><td><code>snaplogic-test-example-tools-container</code></td></tr>
                    <tr><td>Network</td><td><code>snaplogicnet</code> (bridge)</td></tr>
                    <tr><td>Mounted Volumes</td><td>src/, test/, .env, env_files/</td></tr>
                    <tr><td>Pre-installed</td><td>Robot Framework, database drivers (Oracle, Postgres, MySQL, etc.), boto3, kafka-python</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Section 4: Makefile Architecture -->
        <div id="makefile-architecture" class="card">
            <h2>4. Modular Makefile Architecture</h2>
            <p>The framework uses a hierarchical Makefile structure for maintainability and extensibility:</p>

            <div class="flow-diagram">
<pre>
    Makefile (root orchestrator)
    │
    ├── makefiles/common_services/
    │   ├── Makefile.common         # check-env, status, show-running
    │   ├── Makefile.testing        # robot-run-all-tests, robot-run-tests
    │   ├── Makefile.groundplex     # launch-groundplex, stop-groundplex
    │   ├── Makefile.docker         # start-services, stop-services, clean-start
    │   └── Makefile.quality        # lint, format checks
    │
    ├── makefiles/database_services/
    │   ├── Makefile.oracle         # oracle-start, oracle-stop, oracle-load-data
    │   ├── Makefile.postgres       # postgres-start, postgres-stop, postgres-load-data
    │   ├── Makefile.mysql          # mysql-start, mysql-stop, mysql-load-data
    │   ├── Makefile.sqlserver      # sqlserver-start, sqlserver-stop
    │   ├── Makefile.db2            # db2-start, db2-stop
    │   ├── Makefile.teradata       # teradata-start, teradata-stop
    │   └── Makefile.snowflake      # snowflake-specific targets
    │
    ├── makefiles/messaging_services/
    │   ├── Makefile.kafka          # kafka-start, kafka-stop, kafka-create-topics
    │   └── Makefile.activemq       # activemq-start, activemq-stop
    │
    └── makefiles/mock_services/
        ├── Makefile.minio          # minio-start, minio-stop
        ├── Makefile.salesforce     # salesforce-mock-start, salesforce-mock-stop
        └── Makefile.maildev        # maildev-start, maildev-stop
</pre>
            </div>

            <div class="info">
                <strong>Adding a New System:</strong> To add support for a new database or service, create a new Makefile in the appropriate directory (e.g., <code>makefiles/database_services/Makefile.newdb</code>) and a corresponding Docker Compose file. The root Makefile automatically includes it.
            </div>
        </div>

        <!-- Section 5: Test Execution Flow -->
        <div id="test-execution-flow" class="card">
            <h2>5. Test Execution Flow</h2>
            <p>When you run <code>make robot-run-all-tests TAGS="oracle" PROJECT_SPACE_SETUP=True</code>, here is what happens:</p>

            <div class="flow-diagram">
<pre>
    ┌────────────────────────────────────────────────────────────────────┐
    │  Phase 1: Project Space Setup                                      │
    │  ├─ Delete existing project space (if PROJECT_SPACE_SETUP=True)   │
    │  ├─ Create new project space                                       │
    │  ├─ Create Snaplex configuration                                   │
    │  └─ Auto-retry on "active nodes" error (stop GP, wait 60s, retry)│
    ├────────────────────────────────────────────────────────────────────┤
    │  Phase 2: Launch Groundplex                                        │
    │  ├─ Start Groundplex Docker container                              │
    │  ├─ Wait for JCC registration (20 attempts, 10s intervals)        │
    │  └─ Set Travis CI permissions (if applicable)                      │
    ├────────────────────────────────────────────────────────────────────┤
    │  Phase 3: Run Tests                                                │
    │  ├─ __init__.robot: Load env vars, validate, set globals           │
    │  ├─ Create accounts from JSON payload templates                    │
    │  ├─ Import pipelines from .slp files                               │
    │  ├─ Create triggered tasks                                         │
    │  ├─ Execute tasks on Groundplex                                    │
    │  ├─ Verify results (DB queries, file comparisons)                  │
    │  └─ Generate HTML reports (test/robot_output/)                     │
    └────────────────────────────────────────────────────────────────────┘
</pre>
            </div>
        </div>

        <!-- Section 6: Environment Variable Flow -->
        <div id="env-flow" class="card">
            <h2>6. Environment Variable Flow</h2>
            <p>Variables flow through four levels of the system:</p>

            <div class="flow-diagram">
<pre>
    Developer Level              Container Level          Robot Framework Level     CI/CD Level
    ===============              ===============          ====================     ==========

    .env files          -->     Docker Compose     -->    %{VAR} / ${VAR}    -->  Travis/Jenkins
    env_files/*.env              env_file:                Set Global Variable       env injection
                                 - .env
                                 - env_files/*.env

    ┌─────────────┐     ┌──────────────────┐     ┌──────────────────┐     ┌──────────────┐
    │ .env (root)  │ --> │ Tools Container  │ --> │ Robot Variables  │ --> │ Test Reports │
    │ env_files/*  │     │ Groundplex       │     │ %{URL}           │     │ HTML/XML     │
    │              │     │ Database Services│     │ ${ORG_NAME}      │     │ Slack Notify │
    └─────────────┘     └──────────────────┘     └──────────────────┘     └──────────────┘
</pre>
            </div>

            <div class="success">
                <strong>Key Insight:</strong> The root <code>.env</code> file has the <strong>highest precedence</strong> and overrides any variable defined in <code>env_files/</code> subdirectories. This allows you to use Docker defaults for local testing and override with real credentials via the root <code>.env</code> file.
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-links">
            <a href="01_prerequisites.html">&larr; Previous: Prerequisites</a>
            <a href="03_vscode_setup_guide.html">Next: VS Code Setup &rarr;</a>
        </div>

        <footer style="text-align: center; margin-top: 40px; padding: 20px; color: #666; border-top: 1px solid #ddd;">
            <p>Generated for SnapLogic Robot Framework Examples Project</p>
            <p style="font-size: 0.9em;">Last Updated: February 2026</p>
        </footer>
    </div>
</body>
</html>
