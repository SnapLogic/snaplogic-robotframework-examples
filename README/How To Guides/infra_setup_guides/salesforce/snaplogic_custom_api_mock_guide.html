<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Salesforce API Mock Server - Complete Guide</title>
    <style>
        :root {
            --primary: #0059b3;
            --primary-dark: #004494;
            --primary-light: #cce0ff;
            --success: #1b6e20;
            --success-light: #c8f7c5;
            --danger: #b71c1c;
            --danger-light: #ffcdd2;
            --warning: #e65100;
            --warning-light: #ffe0b2;
            --purple: #6a1b9a;
            --purple-light: #e1bee7;
            --teal: #00695c;
            --teal-light: #b2dfdb;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            --font-mono: 'SF Mono', 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius: 10px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-sans); background: var(--gray-100); color: var(--gray-900); line-height: 1.7; font-size: 15px; }
        .section-card { background: #fff; border: 2px solid #d0d7e2; border-radius: 10px; padding: 28px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .section-card h3 { font-size: 1.3em; font-weight: 700; margin-bottom: 16px; }
        .hero { background: linear-gradient(135deg, #1a237e 0%, #0d47a1 50%, #01579b 100%); color: white; padding: 50px 40px 40px; text-align: center; }
        .hero h1 { font-size: 2.4em; font-weight: 700; margin-bottom: 10px; letter-spacing: -0.5px; }
        .hero p { font-size: 1.15em; opacity: 0.85; max-width: 750px; margin: 0 auto; }
        .hero-badges { margin-top: 20px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .hero-badge { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); padding: 6px 16px; border-radius: 20px; font-size: 0.85em; backdrop-filter: blur(4px); }
        .container { max-width: 1300px; margin: 0 auto; padding: 0 24px; }
        .main-tabs { display: flex; gap: 4px; background: white; padding: 8px 8px 0; border-radius: var(--radius) var(--radius) 0 0; box-shadow: var(--shadow-sm); margin-top: -20px; overflow-x: auto; position: sticky; top: 0; z-index: 100; }
        .main-tab { padding: 12px 20px; border: none; background: transparent; cursor: pointer; font-size: 0.9em; font-weight: 600; color: var(--gray-600); border-bottom: 3px solid transparent; transition: all 0.2s; white-space: nowrap; font-family: var(--font-sans); }
        .main-tab:hover { color: var(--primary); background: var(--primary-light); border-radius: 6px 6px 0 0; }
        .main-tab.active { color: var(--primary); border-bottom-color: var(--primary); background: var(--primary-light); border-radius: 6px 6px 0 0; }
        .tab-panel { display: none; background: white; padding: 36px 40px; border-radius: 0 0 var(--radius) var(--radius); box-shadow: var(--shadow-md); margin-bottom: 30px; animation: fadeIn 0.3s ease; }
        .tab-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        h2 { font-size: 1.8em; color: var(--gray-900); margin: 0 0 8px; font-weight: 700; letter-spacing: -0.3px; }
        h3 { font-size: 1.3em; color: var(--gray-800); margin: 30px 0 12px; font-weight: 600; }
        h4 { font-size: 1.05em; color: var(--primary-dark); margin: 24px 0 8px; font-weight: 600; }
        .section-subtitle { color: var(--gray-600); font-size: 1.05em; margin-bottom: 28px; }
        p { margin-bottom: 14px; }
        strong { font-weight: 600; }
        pre { background: #1e1e2e; color: #cdd6f4; padding: 20px 24px; border-radius: 8px; overflow-x: auto; font-family: var(--font-mono); font-size: 0.88em; line-height: 1.6; margin: 14px 0 20px; border: 1px solid #313244; }
        code { font-family: var(--font-mono); background: var(--gray-100); padding: 2px 7px; border-radius: 4px; font-size: 0.9em; color: var(--primary-dark); }
        pre code { background: transparent; padding: 0; color: inherit; font-size: inherit; }
        .code-label { display: inline-block; background: #313244; color: #a6adc8; padding: 3px 12px; border-radius: 6px 6px 0 0; font-size: 0.78em; font-family: var(--font-mono); margin-bottom: -1px; position: relative; z-index: 1; }
        .hl-keyword { color: #cba6f7; } .hl-string { color: #a6e3a1; } .hl-number { color: #fab387; }
        .hl-comment { color: #6c7086; font-style: italic; } .hl-property { color: #89b4fa; }
        .hl-value { color: #f9e2af; } .hl-url { color: #89dceb; } .hl-method { color: #f38ba8; font-weight: 600; }
        .hl-success { color: #a6e3a1; } .hl-error { color: #f38ba8; } .hl-arrow { color: #fab387; }
        table { width: 100%; border-collapse: collapse; margin: 16px 0 24px; }
        th { background: #e3e8f0; padding: 12px 16px; text-align: left; font-weight: 700; font-size: 0.88em; color: #1a1a2e; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 3px solid #9aa5b4; }
        td { padding: 12px 16px; border-bottom: 1px solid var(--gray-200); font-size: 0.95em; }
        tr:hover td { background: var(--gray-50); }
        td code { font-size: 0.88em; }
        .info-box { padding: 18px 22px; border-radius: 8px; margin: 18px 0; border-left: 6px solid; }
        .info-box.blue { background: var(--primary-light); border-color: var(--primary); color: #002952; }
        .info-box.green { background: var(--success-light); border-color: var(--success); color: #0a3d0c; }
        .info-box.red { background: var(--danger-light); border-color: var(--danger); color: #5d0000; }
        .info-box.yellow { background: var(--warning-light); border-color: var(--warning); color: #4e2600; }
        .info-box.purple { background: var(--purple-light); border-color: var(--purple); color: #38006b; }
        .info-box.teal { background: var(--teal-light); border-color: var(--teal); color: #00251a; }
        .info-box-title { font-weight: 700; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; font-size: 1.05em; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0; }
        .card { background: white; border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 24px; transition: all 0.2s; }
        .card:hover { box-shadow: var(--shadow-md); border-color: var(--primary); transform: translateY(-2px); }
        .card-icon { font-size: 2em; margin-bottom: 12px; }
        .card h4 { margin: 0 0 8px; color: var(--gray-900); font-size: 1.1em; }
        .card p { color: var(--gray-600); font-size: 0.92em; margin: 0; }
        .flow-diagram { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 30px; margin: 20px 0; overflow-x: auto; }
        .steps { counter-reset: step-counter; }
        .step { position: relative; padding: 20px 20px 20px 70px; margin: 16px 0; background: var(--gray-50); border-radius: 8px; border: 1px solid var(--gray-200); counter-increment: step-counter; }
        .step::before { content: counter(step-counter); position: absolute; left: 20px; top: 20px; width: 34px; height: 34px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9em; }
        .step h4 { margin: 0 0 8px; font-size: 1.05em; }
        .step p { margin: 0; color: var(--gray-700); }
        .mapping-badge { padding: 3px 10px; border-radius: 12px; font-size: 0.78em; font-weight: 600; }
        .badge-post { background: #e3f2fd; color: #1565c0; } .badge-get { background: #e8f5e9; color: #2e7d32; }
        .badge-patch { background: #fff3e0; color: #e65100; } .badge-delete { background: #ffebee; color: #c62828; }
        .badge-put { background: #f3e5f5; color: #6a1b9a; }
        .sub-tabs { display: flex; gap: 4px; margin: 20px 0 0; border-bottom: 2px solid var(--gray-200); flex-wrap: wrap; }
        .sub-tab { padding: 10px 18px; border: none; background: transparent; cursor: pointer; font-size: 0.88em; font-weight: 600; color: var(--gray-600); border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; font-family: var(--font-sans); }
        .sub-tab:hover { color: var(--primary); }
        .sub-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
        .sub-panel { display: none; padding: 24px 0; }
        .sub-panel.active { display: block; animation: fadeIn 0.2s ease; }
        .cheat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin: 20px 0; }
        .cheat-card { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 20px; }
        .cheat-card h4 { margin: 0 0 12px; font-size: 1em; display: flex; align-items: center; gap: 8px; }
        .dir-tree { font-family: var(--font-mono); font-size: 0.88em; background: #1e1e2e; color: #cdd6f4; padding: 24px; border-radius: 8px; line-height: 1.8; overflow-x: auto; }
        .dir-tree .dir { color: #89b4fa; font-weight: 600; } .dir-tree .file { color: #a6e3a1; } .dir-tree .comment { color: #6c7086; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin: 20px 0; }
        .stat-card { background: white; border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 20px; text-align: center; border-top: 4px solid var(--primary); }
        .stat-card .stat-number { font-size: 2.2em; font-weight: 700; color: var(--primary); }
        .stat-card .stat-label { font-size: 0.85em; color: var(--gray-600); margin-top: 4px; }
        @media (max-width: 768px) { .hero { padding: 30px 20px; } .hero h1 { font-size: 1.6em; } .tab-panel { padding: 20px; } .main-tab { padding: 10px 14px; font-size: 0.82em; } }
        ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-track { background: var(--gray-100); }
        ::-webkit-scrollbar-thumb { background: var(--gray-400); border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: var(--gray-600); }
        ul, ol { margin: 10px 0 16px 24px; } li { margin: 6px 0; } li::marker { color: var(--primary); }
    </style>
</head>
<body>

<!-- HERO -->
<div class="hero">
    <h1>Custom Salesforce API Mock Server</h1>
    <p>A schema-driven Node.js Express server for testing SnapLogic Salesforce Snap integrations &mdash; REST, Bulk v1, Bulk v2, SOQL, SOSL, Platform Events, Wave Analytics, and more.</p>
    <div class="hero-badges">
        <span class="hero-badge">Node.js 18 + Express</span>
        <span class="hero-badge">24 Salesforce Objects</span>
        <span class="hero-badge">50+ API Endpoints</span>
        <span class="hero-badge">SOQL &amp; SOSL Parsing</span>
        <span class="hero-badge">Bulk API v1 &amp; v2</span>
        <span class="hero-badge">CometD Streaming</span>
        <span class="hero-badge">~80MB Docker Image</span>
    </div>
</div>

<div class="container">

<!-- TAB BAR -->
<div class="main-tabs" id="mainTabs">
    <button class="main-tab active" data-tab="overview">Overview</button>
    <button class="main-tab" data-tab="architecture">Architecture</button>
    <button class="main-tab" data-tab="api-endpoints">API Endpoints</button>
    <button class="main-tab" data-tab="schemas">Schemas &amp; Validation</button>
    <button class="main-tab" data-tab="soql-sosl">SOQL &amp; SOSL</button>
    <button class="main-tab" data-tab="bulk-api">Bulk API</button>
    <button class="main-tab" data-tab="events">Events &amp; Streaming</button>
    <button class="main-tab" data-tab="https">HTTPS &amp; Docker</button>
    <button class="main-tab" data-tab="admin">Admin &amp; Debug</button>
    <button class="main-tab" data-tab="extending">Extending</button>
    <button class="main-tab" data-tab="troubleshooting">Troubleshooting</button>
    <button class="main-tab" data-tab="cheatsheet">Cheat Sheet</button>
</div>

<!-- ═══════════════════ TAB: OVERVIEW ═══════════════════ -->
<div class="tab-panel active" id="tab-overview">
    <h2>What Is This?</h2>
    <p class="section-subtitle">A production-grade, schema-driven Salesforce API mock built with Node.js and Express &mdash; purpose-built for SnapLogic pipeline testing.</p>

    <div class="stat-grid">
        <div class="stat-card"><div class="stat-number">~80MB</div><div class="stat-label">Docker Image Size</div></div>
        <div class="stat-card"><div class="stat-number">1-2s</div><div class="stat-label">Startup Time</div></div>
        <div class="stat-card"><div class="stat-number">50+</div><div class="stat-label">API Endpoints</div></div>
        <div class="stat-card"><div class="stat-number">24</div><div class="stat-label">Salesforce Objects</div></div>
        <div class="stat-card"><div class="stat-number">1</div><div class="stat-label">Dependency (Express)</div></div>
        <div class="stat-card"><div class="stat-number">0</div><div class="stat-label">Code Changes to Add Objects</div></div>
    </div>

    <h3>Key Capabilities</h3>
    <div class="card-grid">
        <div class="card" style="border-left: 4px solid var(--primary);"><div class="card-icon">&#128204;</div><h4>Real CRUD with State</h4><p>Create &rarr; Query returns the actual created data. In-memory database shared across REST and Bulk APIs.</p></div>
        <div class="card" style="border-left: 4px solid var(--success);"><div class="card-icon">&#128270;</div><h4>SOQL &amp; SOSL Parsing</h4><p>Real query parsing with SELECT, WHERE, ORDER BY, LIMIT, OFFSET, LIKE, IN, COUNT(). Cross-object SOSL search.</p></div>
        <div class="card" style="border-left: 4px solid var(--purple);"><div class="card-icon">&#128230;</div><h4>Bulk API v1 &amp; v2</h4><p>Full Bulk API support &mdash; CSV/XML ingest, insert/update/upsert/delete operations, query jobs with CSV results.</p></div>
        <div class="card" style="border-left: 4px solid var(--warning);"><div class="card-icon">&#128226;</div><h4>Platform Events &amp; CometD</h4><p>Publish events via REST, subscribe via CometD Bayeux protocol with replay support (-1, -2, from ID).</p></div>
        <div class="card" style="border-left: 4px solid var(--teal);"><div class="card-icon">&#128202;</div><h4>Wave Analytics (SAQL)</h4><p>Dataset listing, versioning, and SAQL query execution with pre-seeded sample data.</p></div>
        <div class="card" style="border-left: 4px solid var(--danger);"><div class="card-icon">&#128737;</div><h4>Field Validation</h4><p>Required fields, picklist values, max length, createable/updateable enforcement &mdash; returns real Salesforce error codes.</p></div>
    </div>

    <div class="info-box blue">
        <div class="info-box-title">Schema-Driven Architecture</div>
        <p>Adding a new Salesforce object is as simple as dropping a <strong>single JSON file</strong> into the <code>schemas/</code> directory. Zero code changes. All routes (CRUD, SOQL, Bulk, Describe) automatically work for the new object.</p>
    </div>

    <h3>Supported Salesforce Objects (24)</h3>
    <table>
        <thead><tr><th>Object</th><th>ID Prefix</th><th>Object</th><th>ID Prefix</th></tr></thead>
        <tbody>
            <tr><td>Account</td><td><code>001</code></td><td>Order</td><td><code>801</code></td></tr>
            <tr><td>Contact</td><td><code>003</code></td><td>OrderItem</td><td><code>802</code></td></tr>
            <tr><td>Opportunity</td><td><code>006</code></td><td>Product2</td><td><code>01t</code></td></tr>
            <tr><td>Lead</td><td><code>00Q</code></td><td>Pricebook2</td><td><code>01s</code></td></tr>
            <tr><td>Case</td><td><code>500</code></td><td>PricebookEntry</td><td><code>01u</code></td></tr>
            <tr><td>Campaign</td><td><code>701</code></td><td>Quote</td><td><code>0Q0</code></td></tr>
            <tr><td>CampaignMember</td><td><code>00v</code></td><td>Contract</td><td><code>800</code></td></tr>
            <tr><td>Task</td><td><code>00T</code></td><td>User</td><td><code>005</code></td></tr>
            <tr><td>Event</td><td><code>00U</code></td><td>Note</td><td><code>002</code></td></tr>
            <tr><td>Attachment</td><td><code>00P</code></td><td>Report</td><td><code>00O</code></td></tr>
            <tr><td>ContentVersion</td><td><code>068</code></td><td>SalesforceDashboard</td><td><code>01Z</code></td></tr>
            <tr><td>ContentDocument</td><td><code>069</code></td><td>PlatformEvent__e</td><td><code>e00</code></td></tr>
        </tbody>
    </table>
</div>

<!-- ═══════════════════ TAB: ARCHITECTURE ═══════════════════ -->
<div class="tab-panel" id="tab-architecture">
    <h2>Architecture Overview</h2>
    <p class="section-subtitle">A single Node.js container replaces two containers, with real CRUD state, query parsing, and Bulk API support.</p>

    <h3>System Diagram</h3>
    <div class="flow-diagram">
<pre><code>  Robot Framework                     SnapLogic Cloud
  (Test Runner)       "Run pipeline"  (Control Plane)
       |                                    |
       +------------------------------------+
                                            |
                                      "Execute on Groundplex"
                                            |
       Docker Network: snaplogicnet         v
  +-----------------------------------------------------+
  |                                                       |
  |   Groundplex Container (snaplogic-groundplex)         |
  |   +----------------+  +--------------------------+   |
  |   |  JCC Runtime   |  | Java Truststore (cacerts) |   |
  |   |  (SnapLogic)   |  | Contains custom server's  |   |
  |   +-------+--------+  | self-signed certificate    |   |
  |           |            +--------------------------+   |
  |           | HTTPS (OAuth, SOQL, CRUD, Bulk, Events)   |
  |           v                                           |
  |   <span class="hl-string">Custom API Mock Server</span> (salesforce-api-mock)         |
  |   Node.js 18 + Express 4.18.2                        |
  |   :8080 (HTTP) / :8443 (HTTPS)                       |
  |   +------------------------+-----------------------+  |
  |   | <span class="hl-property">Route Groups</span>          | <span class="hl-property">Core Libraries</span>         |  |
  |   | search-routes.js      | soql-parser.js         |  |
  |   | download-routes.js    | sosl-parser.js         |  |
  |   | event-routes.js       | validator.js           |  |
  |   | rest-routes.js        | error-formatter.js     |  |
  |   | bulk-v1-routes.js     | id-generator.js        |  |
  |   | bulk-v2-ingest.js     | csv-parser.js          |  |
  |   | bulk-v2-query.js      | bulk-processor.js      |  |
  |   | wave-routes.js        | job-store.js           |  |
  |   | admin-routes.js       | event-bus.js           |  |
  |   +------------------------+-----------------------+  |
  |   | <span class="hl-value">In-Memory Database</span>    | <span class="hl-value">24 Schema Files</span>        |  |
  |   | database[Object]=[]   | schemas/*.json         |  |
  |   +------------------------+-----------------------+  |
  +-----------------------------------------------------+
</code></pre>
    </div>

    <h3>Module Organization</h3>
    <table>
        <thead><tr><th>Module</th><th>File</th><th>Responsibility</th></tr></thead>
        <tbody>
            <tr><td><strong>Entry Point</strong></td><td><code>server.js</code></td><td>Loads schemas, creates Express app, starts HTTP/HTTPS servers</td></tr>
            <tr><td><strong>Route Orchestrator</strong></td><td><code>lib/routes.js</code></td><td>Registers all route groups in correct order</td></tr>
            <tr><td><strong>REST API</strong></td><td><code>lib/routes/rest-routes.js</code></td><td>OAuth, CRUD, SOQL, Describe, Limits</td></tr>
            <tr><td><strong>SOSL Search</strong></td><td><code>lib/routes/search-routes.js</code></td><td>Cross-object FIND/RETURNING queries</td></tr>
            <tr><td><strong>File Download</strong></td><td><code>lib/routes/download-routes.js</code></td><td>Attachment/ContentVersion/Document body download</td></tr>
            <tr><td><strong>Platform Events</strong></td><td><code>lib/routes/event-routes.js</code></td><td>Event publish + CometD streaming subscribe</td></tr>
            <tr><td><strong>Bulk API v1</strong></td><td><code>lib/routes/bulk-v1-routes.js</code></td><td>Legacy XML-based bulk operations</td></tr>
            <tr><td><strong>Bulk v2 Ingest</strong></td><td><code>lib/routes/bulk-v2-ingest-routes.js</code></td><td>CSV upload, insert/update/upsert/delete</td></tr>
            <tr><td><strong>Bulk v2 Query</strong></td><td><code>lib/routes/bulk-v2-query-routes.js</code></td><td>SOQL query with CSV results</td></tr>
            <tr><td><strong>Wave Analytics</strong></td><td><code>lib/routes/wave-routes.js</code></td><td>Dataset listing, SAQL query execution</td></tr>
            <tr><td><strong>Admin</strong></td><td><code>lib/routes/admin-routes.js</code></td><td>Health, database view, reset, debug</td></tr>
            <tr><td><strong>SOQL Parser</strong></td><td><code>lib/soql-parser.js</code></td><td>SELECT, WHERE, ORDER BY, LIMIT, OFFSET parsing</td></tr>
            <tr><td><strong>SOSL Parser</strong></td><td><code>lib/sosl-parser.js</code></td><td>FIND/IN/RETURNING parsing</td></tr>
            <tr><td><strong>Validator</strong></td><td><code>lib/validator.js</code></td><td>Required fields, picklist, max length, createable/updateable</td></tr>
            <tr><td><strong>Error Formatter</strong></td><td><code>lib/error-formatter.js</code></td><td>Salesforce REST API error format (array of error objects)</td></tr>
            <tr><td><strong>ID Generator</strong></td><td><code>lib/id-generator.js</code></td><td>18-character Salesforce-style IDs with object prefix</td></tr>
            <tr><td><strong>CSV Parser</strong></td><td><code>lib/bulk/csv-parser.js</code></td><td>RFC 4180 CSV parse/serialize (zero dependencies)</td></tr>
            <tr><td><strong>Bulk Processor</strong></td><td><code>lib/bulk/bulk-processor.js</code></td><td>Insert/update/upsert/delete operations on database</td></tr>
            <tr><td><strong>Job Store</strong></td><td><code>lib/bulk/job-store.js</code></td><td>Bulk job state management (Open &rarr; JobComplete)</td></tr>
            <tr><td><strong>Event Bus</strong></td><td><code>lib/streaming/event-bus.js</code></td><td>Platform Event pub/sub + CometD client sessions</td></tr>
        </tbody>
    </table>

    <div class="info-box yellow">
        <div class="info-box-title">Route Registration Order Matters</div>
        <p>Routes are registered in <strong>strict order</strong> because Express matches first-fit. Search and download routes must come <strong>before</strong> the generic REST routes, otherwise <code>/sobjects/Account/describe</code> would be caught by <code>/sobjects/:object/:id</code>.</p>
    </div>
</div>

<!-- ═══════════════════ TAB: API ENDPOINTS ═══════════════════ -->
<div class="tab-panel" id="tab-api-endpoints">
    <h2>API Endpoints</h2>
    <p class="section-subtitle">Complete reference of all 50+ Salesforce API endpoints implemented.</p>

    <div class="sub-tabs" data-group="api">
        <button class="sub-tab active" data-subtab="api-auth">OAuth</button>
        <button class="sub-tab" data-subtab="api-rest">REST CRUD</button>
        <button class="sub-tab" data-subtab="api-query">SOQL &amp; SOSL</button>
        <button class="sub-tab" data-subtab="api-bulk">Bulk API</button>
        <button class="sub-tab" data-subtab="api-files">Files</button>
        <button class="sub-tab" data-subtab="api-events">Events</button>
        <button class="sub-tab" data-subtab="api-wave">Wave</button>
    </div>

    <div class="sub-panel active" id="subtab-api-auth">
        <h3>OAuth Authentication</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/oauth2/token</code></td><td>Returns mock Bearer token. Accepts <strong>any credentials</strong>.</td></tr>
            </tbody>
        </table>
        <div class="code-label">Response</div>
<pre><code>{
  <span class="hl-property">"access_token"</span>: <span class="hl-string">"00D000000000000!mock.token.&lt;random&gt;"</span>,
  <span class="hl-property">"instance_url"</span>: <span class="hl-string">"https://salesforce-api-mock:8443"</span>,
  <span class="hl-property">"id"</span>: <span class="hl-string">"https://salesforce-api-mock:8443/id/00D.../005..."</span>,
  <span class="hl-property">"token_type"</span>: <span class="hl-string">"Bearer"</span>,
  <span class="hl-property">"issued_at"</span>: <span class="hl-string">"&lt;epoch&gt;"</span>,
  <span class="hl-property">"signature"</span>: <span class="hl-string">"&lt;random&gt;"</span>
}
</code></pre>
    </div>

    <div class="sub-panel" id="subtab-api-rest">
        <h3>REST API (Single-Record CRUD)</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/sobjects/:object/describe</code></td><td>Object metadata &mdash; fields, types, picklist values</td></tr>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/data/:v/sobjects/:object</code></td><td>Create record (validates, generates ID, stores in DB)</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/sobjects/:object/:id</code></td><td>Read single record by ID</td></tr>
                <tr><td><span class="mapping-badge badge-patch">PATCH</span></td><td><code>/services/data/:v/sobjects/:object/:id</code></td><td>Update record fields</td></tr>
                <tr><td><span class="mapping-badge badge-delete">DELETE</span></td><td><code>/services/data/:v/sobjects/:object/:id</code></td><td>Delete record by ID</td></tr>
                <tr><td><span class="mapping-badge badge-patch">PATCH</span></td><td><code>/services/data/:v/sobjects/:object/:field/:val</code></td><td>Upsert by external ID field</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/limits</code></td><td>API limits (mock values)</td></tr>
            </tbody>
        </table>
        <div class="info-box green">
            <div class="info-box-title">Real CRUD &mdash; Not Canned Responses</div>
            <p>Records are stored in an in-memory database. <code>POST /sobjects/Account</code> creates a record that is immediately queryable via <code>GET /query?q=SELECT...</code>. Data flows between REST API, Bulk API, and SOQL queries.</p>
        </div>
    </div>

    <div class="sub-panel" id="subtab-api-query">
        <h3>SOQL Queries</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/query?q=SELECT...</code></td><td>Execute SOQL query with real parsing and filtering</td></tr>
            </tbody>
        </table>
        <h3>SOSL Search</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/search?q=FIND...</code></td><td>Cross-object text search with RETURNING clause</td></tr>
            </tbody>
        </table>
    </div>

    <div class="sub-panel" id="subtab-api-bulk">
        <h3>Bulk API v1 (XML-based)</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/async/:v/job</code></td><td>Create job (insert/update/upsert/delete)</td></tr>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/async/:v/job/:id/batch</code></td><td>Add batch (CSV/XML/JSON data)</td></tr>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/async/:v/job/:id</code></td><td>Close or abort job</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/async/:v/job/:id</code></td><td>Get job info</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/async/:v/job/:id/batch</code></td><td>List batches</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/async/:v/job/:id/batch/:bid/result</code></td><td>Get batch results</td></tr>
            </tbody>
        </table>
        <h3>Bulk API 2.0 Ingest</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/data/:v/jobs/ingest</code></td><td>Create ingest job</td></tr>
                <tr><td><span class="mapping-badge badge-put">PUT</span></td><td><code>/services/data/:v/jobs/ingest/:id/batches</code></td><td>Upload CSV data</td></tr>
                <tr><td><span class="mapping-badge badge-patch">PATCH</span></td><td><code>/services/data/:v/jobs/ingest/:id</code></td><td>Close job (triggers processing)</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/jobs/ingest/:id/successfulResults</code></td><td>CSV of successful records</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/jobs/ingest/:id/failedResults</code></td><td>CSV of failed records</td></tr>
            </tbody>
        </table>
        <h3>Bulk API 2.0 Query</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/data/:v/jobs/query</code></td><td>Create query job (SOQL &rarr; CSV results)</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/jobs/query/:id/results</code></td><td>Download CSV results</td></tr>
            </tbody>
        </table>
    </div>

    <div class="sub-panel" id="subtab-api-files">
        <h3>File Body Downloads</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/sobjects/Attachment/:id/Body</code></td><td>Download Attachment body</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/sobjects/ContentVersion/:id/VersionData</code></td><td>Download ContentVersion file</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/sobjects/Document/:id/Body</code></td><td>Download Document body</td></tr>
            </tbody>
        </table>
        <p>Body field stored as base64 in the record, decoded to binary on download. Content-Type taken from the record's <code>ContentType</code> field.</p>
    </div>

    <div class="sub-panel" id="subtab-api-events">
        <h3>Platform Events &amp; CometD Streaming</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/data/:v/sobjects/:Object__e</code></td><td>Publish Platform Event</td></tr>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/cometd/:version</code></td><td>CometD Bayeux protocol (handshake, subscribe, connect, disconnect)</td></tr>
            </tbody>
        </table>
        <p>Supports replay IDs: <code>-1</code> (tip/new only), <code>-2</code> (earliest), or a specific replay ID.</p>
    </div>

    <div class="sub-panel" id="subtab-api-wave">
        <h3>Wave Analytics (Einstein Analytics)</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/wave/datasets</code></td><td>List all datasets</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/wave/datasets/:id</code></td><td>Get dataset details</td></tr>
                <tr><td><span class="mapping-badge badge-get">GET</span></td><td><code>/services/data/:v/wave/datasets/:id/versions</code></td><td>Get dataset versions</td></tr>
                <tr><td><span class="mapping-badge badge-post">POST</span></td><td><code>/services/data/:v/wave/query</code></td><td>Execute SAQL query</td></tr>
            </tbody>
        </table>
        <p>Pre-seeded with sample datasets (SalesPipeline, CustomerMetrics). Supports <code>load</code>, <code>foreach generate</code>, <code>filter by</code>, <code>order by</code>, <code>limit</code> SAQL statements.</p>
    </div>
</div>

<!-- ═══════════════════ TAB: SCHEMAS & VALIDATION ═══════════════════ -->
<div class="tab-panel" id="tab-schemas">
    <h2>Schemas &amp; Field Validation</h2>
    <p class="section-subtitle">Schema-driven validation that returns real Salesforce error codes.</p>

    <h3>Schema File Structure</h3>
    <div class="code-label">schemas/Account.json (example)</div>
<pre><code>{
  <span class="hl-property">"name"</span>: <span class="hl-string">"Account"</span>,
  <span class="hl-property">"label"</span>: <span class="hl-string">"Account"</span>,
  <span class="hl-property">"labelPlural"</span>: <span class="hl-string">"Accounts"</span>,
  <span class="hl-property">"idPrefix"</span>: <span class="hl-string">"001"</span>,
  <span class="hl-property">"keyPrefix"</span>: <span class="hl-string">"001"</span>,
  <span class="hl-property">"fields"</span>: {
    <span class="hl-property">"Name"</span>: {
      <span class="hl-property">"type"</span>: <span class="hl-string">"string"</span>, <span class="hl-property">"label"</span>: <span class="hl-string">"Account Name"</span>,
      <span class="hl-property">"required"</span>: <span class="hl-value">true</span>, <span class="hl-property">"createable"</span>: <span class="hl-value">true</span>,
      <span class="hl-property">"updateable"</span>: <span class="hl-value">true</span>, <span class="hl-property">"maxLength"</span>: <span class="hl-number">255</span>
    },
    <span class="hl-property">"Type"</span>: {
      <span class="hl-property">"type"</span>: <span class="hl-string">"picklist"</span>, <span class="hl-property">"label"</span>: <span class="hl-string">"Type"</span>,
      <span class="hl-property">"values"</span>: [<span class="hl-string">"Customer"</span>, <span class="hl-string">"Partner"</span>, <span class="hl-string">"Prospect"</span>],
      <span class="hl-property">"required"</span>: <span class="hl-value">false</span>
    },
    <span class="hl-property">"CreatedDate"</span>: {
      <span class="hl-property">"type"</span>: <span class="hl-string">"datetime"</span>,
      <span class="hl-property">"createable"</span>: <span class="hl-value">false</span>, <span class="hl-property">"updateable"</span>: <span class="hl-value">false</span>
    }
  }
}
</code></pre>

    <h3>Validation Rules</h3>
    <table>
        <thead><tr><th>Rule</th><th>When Checked</th><th>Salesforce Error Code</th></tr></thead>
        <tbody>
            <tr><td>Required fields missing</td><td>CREATE only</td><td><code>REQUIRED_FIELD_MISSING</code></td></tr>
            <tr><td>Invalid picklist value</td><td>CREATE &amp; UPDATE</td><td><code>INVALID_OR_NULL_FOR_RESTRICTED_PICKLIST</code></td></tr>
            <tr><td>String exceeds max length</td><td>CREATE &amp; UPDATE</td><td><code>STRING_TOO_LONG</code></td></tr>
            <tr><td>Field not createable</td><td>CREATE</td><td><code>INVALID_FIELD_FOR_INSERT_UPDATE</code></td></tr>
            <tr><td>Field not updateable</td><td>UPDATE</td><td><code>INVALID_FIELD_FOR_INSERT_UPDATE</code></td></tr>
            <tr><td>Record not found</td><td>READ / UPDATE / DELETE</td><td><code>NOT_FOUND</code></td></tr>
            <tr><td>Unknown object type</td><td>Any operation</td><td><code>NOT_FOUND</code></td></tr>
        </tbody>
    </table>

    <div class="info-box red">
        <div class="info-box-title">Error Format &mdash; Matches Real Salesforce</div>
        <p>All errors are returned as <strong>arrays</strong> (not single objects), matching the real Salesforce REST API format:</p>
    </div>
<pre><code>[{
  <span class="hl-property">"message"</span>: <span class="hl-string">"Required fields are missing: [Name]"</span>,
  <span class="hl-property">"errorCode"</span>: <span class="hl-string">"REQUIRED_FIELD_MISSING"</span>,
  <span class="hl-property">"fields"</span>: [<span class="hl-string">"Name"</span>]
}]
</code></pre>

    <h3>ID Generation</h3>
    <p>The <code>id-generator.js</code> module produces 18-character Salesforce-style IDs: the first 3 characters are the object's <code>idPrefix</code> (e.g., <code>001</code> for Account), followed by 15 random alphanumeric uppercase characters.</p>
</div>

<!-- ═══════════════════ TAB: SOQL & SOSL ═══════════════════ -->
<div class="tab-panel" id="tab-soql-sosl">
    <h2>SOQL &amp; SOSL Query Engines</h2>
    <p class="section-subtitle">Zero-dependency query parsers that execute against the in-memory database &mdash; returning real, filtered, sorted results.</p>

    <h3>SOQL Support</h3>
    <table>
        <thead><tr><th>Feature</th><th>Syntax</th><th>Supported?</th></tr></thead>
        <tbody>
            <tr><td>SELECT fields</td><td><code>SELECT Id, Name, Type</code></td><td>Yes</td></tr>
            <tr><td>SELECT all</td><td><code>SELECT *</code></td><td>Yes (extension)</td></tr>
            <tr><td>FROM object</td><td><code>FROM Account</code></td><td>Yes</td></tr>
            <tr><td>WHERE equals</td><td><code>WHERE Type = 'Customer'</code></td><td>Yes</td></tr>
            <tr><td>WHERE not equals</td><td><code>WHERE Type != 'Partner'</code></td><td>Yes</td></tr>
            <tr><td>WHERE comparison</td><td><code>WHERE Amount > 10000</code></td><td>Yes (&gt;, &gt;=, &lt;, &lt;=)</td></tr>
            <tr><td>WHERE LIKE</td><td><code>WHERE Name LIKE '%Corp%'</code></td><td>Yes</td></tr>
            <tr><td>WHERE IN</td><td><code>WHERE Type IN ('Customer','Partner')</code></td><td>Yes</td></tr>
            <tr><td>WHERE NOT IN</td><td><code>WHERE Type NOT IN ('Prospect')</code></td><td>Yes</td></tr>
            <tr><td>AND / OR</td><td><code>WHERE Type='Customer' AND Name LIKE '%Acme%'</code></td><td>Yes</td></tr>
            <tr><td>ORDER BY</td><td><code>ORDER BY Name ASC</code></td><td>Yes (ASC/DESC, NULLS FIRST/LAST)</td></tr>
            <tr><td>LIMIT</td><td><code>LIMIT 10</code></td><td>Yes</td></tr>
            <tr><td>OFFSET</td><td><code>OFFSET 5</code></td><td>Yes</td></tr>
            <tr><td>COUNT()</td><td><code>SELECT COUNT() FROM Account</code></td><td>Yes</td></tr>
        </tbody>
    </table>

    <div class="code-label">Example: SOQL query flow</div>
<pre><code><span class="hl-comment"># Create records</span>
<span class="hl-keyword">curl</span> -X <span class="hl-method">POST</span> <span class="hl-url">http://localhost:8080/services/data/v59.0/sobjects/Account</span> \
  -H <span class="hl-string">"Content-Type: application/json"</span> \
  -d <span class="hl-string">'{"Name": "Acme Corp", "Type": "Customer"}'</span>

<span class="hl-comment"># Query them back</span>
<span class="hl-keyword">curl</span> <span class="hl-string">"http://localhost:8080/services/data/v59.0/query?q=SELECT+Id,Name+FROM+Account+WHERE+Type='Customer'"</span>

<span class="hl-comment"># Result: returns the actual Acme Corp record that was just created</span>
</code></pre>

    <h3>SOSL Support</h3>
    <table>
        <thead><tr><th>Feature</th><th>Syntax</th></tr></thead>
        <tbody>
            <tr><td>FIND</td><td><code>FIND {searchTerm}</code></td></tr>
            <tr><td>IN scope</td><td><code>IN ALL FIELDS</code>, <code>IN NAME FIELDS</code>, <code>IN EMAIL FIELDS</code>, <code>IN PHONE FIELDS</code></td></tr>
            <tr><td>RETURNING</td><td><code>RETURNING Account(Id, Name), Contact(Id, Email WHERE LastName = 'Smith' LIMIT 5)</code></td></tr>
        </tbody>
    </table>
    <p>SOSL performs a cross-object text search, matching the search term against string fields in the database.</p>
</div>

<!-- ═══════════════════ TAB: BULK API ═══════════════════ -->
<div class="tab-panel" id="tab-bulk-api">
    <h2>Bulk API v1 &amp; v2</h2>
    <p class="section-subtitle">Full Bulk API support for high-volume data operations via CSV and XML.</p>

    <div class="sub-tabs" data-group="bulk">
        <button class="sub-tab active" data-subtab="bulk-v2">Bulk API 2.0 (Ingest)</button>
        <button class="sub-tab" data-subtab="bulk-v2q">Bulk API 2.0 (Query)</button>
        <button class="sub-tab" data-subtab="bulk-v1">Bulk API v1 (Legacy)</button>
    </div>

    <div class="sub-panel active" id="subtab-bulk-v2">
        <h3>Bulk API 2.0 Ingest Lifecycle</h3>
        <div class="steps">
            <div class="step"><h4>Create Job</h4><p><code>POST /services/data/v59.0/jobs/ingest</code> with <code>{"object": "Account", "operation": "insert"}</code>. State: <strong>Open</strong>.</p></div>
            <div class="step"><h4>Upload CSV Data</h4><p><code>PUT /services/data/v59.0/jobs/ingest/{id}/batches</code> with <code>Content-Type: text/csv</code>. Multi-batch supported (duplicate headers stripped).</p></div>
            <div class="step"><h4>Close Job</h4><p><code>PATCH /services/data/v59.0/jobs/ingest/{id}</code> with <code>{"state": "UploadComplete"}</code>. Processing runs synchronously. State: <strong>JobComplete</strong>.</p></div>
            <div class="step"><h4>Get Results</h4><p><code>GET .../successfulResults</code> (CSV with sf__Id, sf__Created columns) and <code>GET .../failedResults</code> (CSV with sf__Error).</p></div>
        </div>

        <h4>Supported Operations</h4>
        <table>
            <thead><tr><th>Operation</th><th>Description</th><th>Notes</th></tr></thead>
            <tbody>
                <tr><td><code>insert</code></td><td>Create new records</td><td>Generates ID, validates required fields</td></tr>
                <tr><td><code>update</code></td><td>Update existing records by ID</td><td>Finds by Id column in CSV</td></tr>
                <tr><td><code>upsert</code></td><td>Update if exists, insert if not</td><td>Matches by <code>externalIdFieldName</code></td></tr>
                <tr><td><code>delete</code></td><td>Delete records by ID</td><td>Removes from in-memory database</td></tr>
            </tbody>
        </table>
    </div>

    <div class="sub-panel" id="subtab-bulk-v2q">
        <h3>Bulk API 2.0 Query</h3>
        <div class="steps">
            <div class="step"><h4>Create Query Job</h4><p><code>POST /services/data/v59.0/jobs/query</code> with <code>{"query": "SELECT Id, Name FROM Account"}</code>. Executes synchronously.</p></div>
            <div class="step"><h4>Download Results</h4><p><code>GET /services/data/v59.0/jobs/query/{id}/results</code> returns CSV. Includes <code>Sforce-Locator</code> and <code>Sforce-NumberOfRecords</code> headers.</p></div>
        </div>
    </div>

    <div class="sub-panel" id="subtab-bulk-v1">
        <h3>Bulk API v1 (Legacy XML-Based)</h3>
        <p>Full support for the legacy Bulk API with XML job/batch management and CSV/XML/JSON content types.</p>
        <table>
            <thead><tr><th>Operation</th><th>Content Types</th><th>Notes</th></tr></thead>
            <tbody>
                <tr><td><code>insert</code></td><td>CSV, XML, JSON</td><td>Generates IDs, validates fields</td></tr>
                <tr><td><code>update</code></td><td>CSV, XML, JSON</td><td>Finds by Id column</td></tr>
                <tr><td><code>upsert</code></td><td>CSV, XML, JSON</td><td>Uses <code>externalIdFieldName</code> from job</td></tr>
                <tr><td><code>delete</code></td><td>CSV, XML, JSON</td><td>Removes by Id</td></tr>
            </tbody>
        </table>
        <div class="info-box yellow">
            <div class="info-box-title">Synchronous Processing</div>
            <p>All bulk operations complete <strong>immediately</strong> (real Salesforce is asynchronous). This is acceptable for testing because test harnesses poll quickly anyway.</p>
        </div>
    </div>
</div>

<!-- ═══════════════════ TAB: EVENTS & STREAMING ═══════════════════ -->
<div class="tab-panel" id="tab-events">
    <h2>Platform Events &amp; CometD Streaming</h2>
    <p class="section-subtitle">Publish Platform Events via REST and subscribe via CometD Bayeux protocol.</p>

    <h3>Publishing Events</h3>
<pre><code><span class="hl-keyword">curl</span> -X <span class="hl-method">POST</span> <span class="hl-url">http://localhost:8080/services/data/v59.0/sobjects/MyEvent__e</span> \
  -H <span class="hl-string">"Content-Type: application/json"</span> \
  -d <span class="hl-string">'{"Message__c": "Hello from test", "Priority__c": "High"}'</span>
</code></pre>

    <h3>CometD Bayeux Protocol</h3>
    <table>
        <thead><tr><th>Channel</th><th>Purpose</th></tr></thead>
        <tbody>
            <tr><td><code>/meta/handshake</code></td><td>Establish client session, get clientId</td></tr>
            <tr><td><code>/meta/subscribe</code></td><td>Subscribe to event channel (e.g., <code>/event/MyEvent__e</code>)</td></tr>
            <tr><td><code>/meta/connect</code></td><td>Long-poll for new events (delivers pending events)</td></tr>
            <tr><td><code>/meta/disconnect</code></td><td>End client session</td></tr>
        </tbody>
    </table>

    <h4>Replay Support</h4>
    <table>
        <thead><tr><th>Replay ID</th><th>Behavior</th></tr></thead>
        <tbody>
            <tr><td><code>-1</code></td><td>Tip &mdash; only receive new events from this point forward</td></tr>
            <tr><td><code>-2</code></td><td>Earliest &mdash; receive all stored events</td></tr>
            <tr><td><code>N</code></td><td>From specific replay ID &mdash; receive events after ID N</td></tr>
        </tbody>
    </table>
</div>

<!-- ═══════════════════ TAB: HTTPS & DOCKER ═══════════════════ -->
<div class="tab-panel" id="tab-https">
    <h2>HTTPS &amp; Docker Configuration</h2>
    <p class="section-subtitle">Lightweight Docker image with PKCS12 certificate support &mdash; reuses the same certificate trusted by Groundplex.</p>

    <h3>Dockerfile</h3>
    <div class="code-label">Dockerfile</div>
<pre><code><span class="hl-keyword">FROM</span> <span class="hl-string">node:18-alpine</span>
<span class="hl-keyword">WORKDIR</span> /app

<span class="hl-comment"># Install wget for health check</span>
<span class="hl-keyword">RUN</span> apk add --no-cache wget

<span class="hl-comment"># Install dependencies (Express only)</span>
<span class="hl-keyword">COPY</span> package.json ./
<span class="hl-keyword">RUN</span> npm install --production && npm cache clean --force

<span class="hl-comment"># Copy application code + schemas</span>
<span class="hl-keyword">COPY</span> server.js ./
<span class="hl-keyword">COPY</span> lib/ ./lib/
<span class="hl-keyword">COPY</span> schemas/ ./schemas/

<span class="hl-comment"># Certs directory for mounted P12 keystore</span>
<span class="hl-keyword">RUN</span> mkdir -p /app/certs

<span class="hl-comment"># Non-root user for security</span>
<span class="hl-keyword">USER</span> appuser

<span class="hl-keyword">EXPOSE</span> <span class="hl-number">8080</span> <span class="hl-number">8443</span>
<span class="hl-keyword">CMD</span> [<span class="hl-string">"node"</span>, <span class="hl-string">"server.js"</span>]
</code></pre>

    <h3>HTTPS Certificate Strategy</h3>
    <div class="info-box green">
        <div class="info-box-title">Zero Certificate Changes Required</div>
        <p>The custom server reuses the <strong>same PKCS12 keystore</strong> (<code>custom-keystore.p12</code>) that is already imported into Groundplex's Java truststore. Node.js loads <code>.p12</code> files directly via the <code>pfx</code> option &mdash; no PEM conversion needed.</p>
    </div>

    <h3>Environment Variables</h3>
    <table>
        <thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead>
        <tbody>
            <tr><td><code>HTTP_PORT</code></td><td><code>8080</code></td><td>HTTP listener port</td></tr>
            <tr><td><code>HTTPS_PORT</code></td><td><code>8443</code></td><td>HTTPS listener port</td></tr>
            <tr><td><code>P12_FILE</code></td><td><code>/app/certs/custom-keystore.p12</code></td><td>PKCS12 keystore path</td></tr>
            <tr><td><code>P12_PASSWORD</code></td><td><code>password</code></td><td>Keystore password</td></tr>
            <tr><td><code>SCHEMA_DIR</code></td><td><code>/app/schemas</code></td><td>Schema files directory</td></tr>
        </tbody>
    </table>

    <h3>Docker Compose Integration</h3>
    <div class="code-label">docker-compose service</div>
<pre><code><span class="hl-property">salesforce-api-mock</span>:
  <span class="hl-property">build</span>: <span class="hl-string">./docker/salesforce/custom-server</span>
  <span class="hl-property">container_name</span>: <span class="hl-string">salesforce-api-mock</span>
  <span class="hl-property">ports</span>:
    - <span class="hl-string">"8080:8080"</span>
    - <span class="hl-string">"8443:8443"</span>
  <span class="hl-property">volumes</span>:
    - <span class="hl-string">./certs/custom-keystore.p12:/app/certs/custom-keystore.p12:ro</span>
    - <span class="hl-string">./schemas:/app/schemas:ro</span>  <span class="hl-comment"># Optional: override schemas at runtime</span>
  <span class="hl-property">networks</span>:
    - <span class="hl-string">snaplogicnet</span>
</code></pre>
</div>

<!-- ═══════════════════ TAB: ADMIN & DEBUG ═══════════════════ -->
<div class="tab-panel" id="tab-admin">
    <h2>Admin &amp; Debug Endpoints</h2>
    <p class="section-subtitle">Built-in endpoints for inspecting data, monitoring health, and resetting state.</p>

    <table>
        <thead><tr><th>Endpoint</th><th>Description</th></tr></thead>
        <tbody>
            <tr><td><code>GET /health</code></td><td>Detailed health check (uptime, objects, record counts, memory)</td></tr>
            <tr><td><code>GET /__admin/health</code></td><td>Simple health check (<code>{"status":"OK"}</code>)</td></tr>
            <tr><td><code>GET /__admin/db</code></td><td>View entire in-memory database (all objects, all records)</td></tr>
            <tr><td><code>GET /__admin/db/:object</code></td><td>View records for a specific object</td></tr>
            <tr><td><code>POST /__admin/reset</code></td><td>Clear all data (reset database to empty state)</td></tr>
            <tr><td><code>GET /__admin/schemas</code></td><td>List all loaded schemas with field counts</td></tr>
            <tr><td><code>GET /__admin/bulk-jobs</code></td><td>List all Bulk API jobs with status</td></tr>
            <tr><td><code>GET /__admin/events</code></td><td>List all published Platform Events</td></tr>
            <tr><td><code>GET /__admin/streaming-clients</code></td><td>List active CometD client sessions</td></tr>
        </tbody>
    </table>

    <div class="info-box blue">
        <div class="info-box-title">Web Dashboard</div>
        <p>Open <code>custom-server-dashboard.html</code> in a browser for a visual interface to view data, create records, and monitor the server.</p>
    </div>
</div>

<!-- ═══════════════════ TAB: EXTENDING ═══════════════════ -->
<div class="tab-panel" id="tab-extending">
    <h2>Extending: Adding New Objects</h2>
    <p class="section-subtitle">Add support for any Salesforce object by creating a single JSON schema file. Zero code changes required.</p>

    <h3>Three Steps to Add a New Object</h3>
    <div class="steps">
        <div class="step"><h4>Create the Schema File</h4><p>Create <code>schemas/MyObject__c.json</code> with the object name, ID prefix, and field definitions.</p></div>
        <div class="step"><h4>Restart the Container</h4><p><code>docker restart salesforce-api-mock</code> &mdash; the server auto-loads all <code>*.json</code> files from the schemas directory.</p></div>
        <div class="step"><h4>Done &mdash; All Routes Work</h4><p>CRUD, SOQL, Describe, Bulk v1, Bulk v2, and SOSL all work immediately for the new object.</p></div>
    </div>

    <h3>Schema Template</h3>
    <div class="code-label">schemas/MyCustomObject__c.json</div>
<pre><code>{
  <span class="hl-property">"name"</span>: <span class="hl-string">"MyCustomObject__c"</span>,
  <span class="hl-property">"label"</span>: <span class="hl-string">"My Custom Object"</span>,
  <span class="hl-property">"labelPlural"</span>: <span class="hl-string">"My Custom Objects"</span>,
  <span class="hl-property">"idPrefix"</span>: <span class="hl-string">"a00"</span>,
  <span class="hl-property">"keyPrefix"</span>: <span class="hl-string">"a00"</span>,
  <span class="hl-property">"fields"</span>: {
    <span class="hl-property">"Name"</span>: {
      <span class="hl-property">"type"</span>: <span class="hl-string">"string"</span>,
      <span class="hl-property">"label"</span>: <span class="hl-string">"Name"</span>,
      <span class="hl-property">"required"</span>: <span class="hl-value">true</span>,
      <span class="hl-property">"createable"</span>: <span class="hl-value">true</span>,
      <span class="hl-property">"updateable"</span>: <span class="hl-value">true</span>,
      <span class="hl-property">"maxLength"</span>: <span class="hl-number">255</span>
    },
    <span class="hl-property">"Status__c"</span>: {
      <span class="hl-property">"type"</span>: <span class="hl-string">"picklist"</span>,
      <span class="hl-property">"label"</span>: <span class="hl-string">"Status"</span>,
      <span class="hl-property">"values"</span>: [<span class="hl-string">"New"</span>, <span class="hl-string">"In Progress"</span>, <span class="hl-string">"Closed"</span>],
      <span class="hl-property">"required"</span>: <span class="hl-value">false</span>,
      <span class="hl-property">"createable"</span>: <span class="hl-value">true</span>,
      <span class="hl-property">"updateable"</span>: <span class="hl-value">true</span>
    }
  }
}
</code></pre>

    <h3>Directory Structure</h3>
    <div class="dir-tree">
<span class="dir">custom-server/</span>
<span class="file">+-- server.js</span>                      <span class="comment"># Entry point: loads schemas, starts Express</span>
<span class="file">+-- package.json</span>                   <span class="comment"># Single dependency: express 4.18.2</span>
<span class="file">+-- Dockerfile</span>                     <span class="comment"># node:18-alpine, ~80MB image</span>
<span class="dir">+-- schemas/</span>                       <span class="comment"># One JSON file per Salesforce object</span>
<span class="file">|   +-- Account.json</span>               <span class="comment"># 001 prefix, Name/Type/Industry/Phone/...</span>
<span class="file">|   +-- Contact.json</span>               <span class="comment"># 003 prefix, FirstName/LastName/Email/...</span>
<span class="file">|   +-- Opportunity.json</span>           <span class="comment"># 006 prefix, Name/Amount/StageName/...</span>
<span class="file">|   +-- Lead.json</span>                  <span class="comment"># 00Q prefix, FirstName/LastName/Company/...</span>
<span class="file">|   +-- Case.json</span>                  <span class="comment"># 500 prefix, Subject/Status/Priority/...</span>
<span class="file">|   +-- ... (24 objects total)</span>
<span class="dir">+-- lib/</span>
<span class="file">|   +-- routes.js</span>                  <span class="comment"># Route orchestrator</span>
<span class="dir">|   +-- routes/</span>                    <span class="comment"># 9 route group files</span>
<span class="file">|   |   +-- rest-routes.js</span>         <span class="comment"># OAuth, CRUD, SOQL, Describe</span>
<span class="file">|   |   +-- search-routes.js</span>       <span class="comment"># SOSL cross-object search</span>
<span class="file">|   |   +-- download-routes.js</span>     <span class="comment"># File body download</span>
<span class="file">|   |   +-- event-routes.js</span>        <span class="comment"># Platform Events + CometD</span>
<span class="file">|   |   +-- bulk-v1-routes.js</span>      <span class="comment"># Bulk API v1 (XML)</span>
<span class="file">|   |   +-- bulk-v2-ingest-routes.js</span> <span class="comment"># Bulk API 2.0 write</span>
<span class="file">|   |   +-- bulk-v2-query-routes.js</span>  <span class="comment"># Bulk API 2.0 read</span>
<span class="file">|   |   +-- wave-routes.js</span>         <span class="comment"># Wave Analytics</span>
<span class="file">|   |   +-- admin-routes.js</span>        <span class="comment"># Health, debug, reset</span>
<span class="file">|   +-- soql-parser.js</span>             <span class="comment"># Zero-dependency SOQL parser</span>
<span class="file">|   +-- sosl-parser.js</span>             <span class="comment"># Zero-dependency SOSL parser</span>
<span class="file">|   +-- validator.js</span>               <span class="comment"># Field validation engine</span>
<span class="file">|   +-- error-formatter.js</span>         <span class="comment"># Salesforce error format</span>
<span class="file">|   +-- id-generator.js</span>            <span class="comment"># 18-char ID generation</span>
<span class="dir">|   +-- bulk/</span>
<span class="file">|   |   +-- csv-parser.js</span>          <span class="comment"># RFC 4180 CSV parse/serialize</span>
<span class="file">|   |   +-- bulk-processor.js</span>      <span class="comment"># Insert/update/upsert/delete logic</span>
<span class="file">|   |   +-- job-store.js</span>           <span class="comment"># Bulk job state management</span>
<span class="dir">|   +-- streaming/</span>
<span class="file">|       +-- event-bus.js</span>           <span class="comment"># Platform Event pub/sub + CometD</span>
<span class="file">+-- custom-server-dashboard.html</span>   <span class="comment"># Web-based admin dashboard</span>
    </div>
</div>

<!-- ═══════════════════ TAB: TROUBLESHOOTING ═══════════════════ -->
<div class="tab-panel" id="tab-troubleshooting">
    <h2>Troubleshooting</h2>
    <p class="section-subtitle">Common issues and their solutions.</p>

    <div class="sub-tabs" data-group="troubleshoot">
        <button class="sub-tab active" data-subtab="ts-start">Startup</button>
        <button class="sub-tab" data-subtab="ts-ssl">SSL/HTTPS</button>
        <button class="sub-tab" data-subtab="ts-query">Queries</button>
        <button class="sub-tab" data-subtab="ts-bulk">Bulk API</button>
    </div>

    <div class="sub-panel active" id="subtab-ts-start">
        <h3>Server Won't Start</h3>
        <div class="section-card">
            <h4 style="color: var(--danger);">Container exits immediately</h4>
<pre><code><span class="hl-comment"># Check logs for schema loading errors</span>
<span class="hl-keyword">docker logs</span> salesforce-api-mock

<span class="hl-comment"># Common cause: invalid JSON in schema files</span>
<span class="hl-comment"># Look for: "Failed to load X.json: Unexpected token"</span>
</code></pre>
        </div>
        <div class="section-card">
            <h4 style="color: var(--danger);">Port already in use</h4>
<pre><code><span class="hl-keyword">lsof</span> -i :<span class="hl-number">8080</span>
<span class="hl-keyword">lsof</span> -i :<span class="hl-number">8443</span>
<span class="hl-comment"># Change ports via environment variables: HTTP_PORT, HTTPS_PORT</span>
</code></pre>
        </div>
    </div>

    <div class="sub-panel" id="subtab-ts-ssl">
        <h3>SSL/HTTPS Issues</h3>
        <div class="section-card">
            <h4 style="color: var(--danger);">HTTPS not started (only HTTP available)</h4>
            <p>Check that the P12 keystore is mounted correctly in docker-compose:</p>
<pre><code><span class="hl-property">volumes</span>:
  - <span class="hl-string">./certs/custom-keystore.p12:/app/certs/custom-keystore.p12:ro</span>
</code></pre>
        </div>
        <div class="section-card">
            <h4 style="color: var(--danger);">Groundplex SSL errors</h4>
            <p>The custom server reuses the same certificate. If Groundplex already trusts it, no changes needed. If not:</p>
<pre><code><span class="hl-keyword">make</span> setup-groundplex-cert
<span class="hl-keyword">make</span> groundplex-check-cert
</code></pre>
        </div>
    </div>

    <div class="sub-panel" id="subtab-ts-query">
        <h3>Query Issues</h3>
        <div class="section-card">
            <h4 style="color: var(--danger);">SOQL returns empty results</h4>
<pre><code><span class="hl-comment"># Check what data exists</span>
<span class="hl-keyword">curl</span> <span class="hl-url">http://localhost:8080/__admin/db/Account</span>

<span class="hl-comment"># Data is in-memory only - lost on container restart</span>
<span class="hl-comment"># Create records first, then query</span>
</code></pre>
        </div>
        <div class="section-card">
            <h4 style="color: var(--danger);">MALFORMED_QUERY error</h4>
            <p>Check URL encoding. Spaces must be <code>+</code> or <code>%20</code>. Single quotes must be properly escaped.</p>
        </div>
    </div>

    <div class="sub-panel" id="subtab-ts-bulk">
        <h3>Bulk API Issues</h3>
        <div class="section-card">
            <h4 style="color: var(--danger);">Bulk job stays in Open state</h4>
            <p>You must close the job to trigger processing:</p>
<pre><code><span class="hl-keyword">curl</span> -X <span class="hl-method">PATCH</span> <span class="hl-url">http://localhost:8080/services/data/v59.0/jobs/ingest/{jobId}</span> \
  -H <span class="hl-string">"Content-Type: application/json"</span> \
  -d <span class="hl-string">'{"state": "UploadComplete"}'</span>
</code></pre>
        </div>
        <div class="section-card">
            <h4 style="color: var(--danger);">CSV parsing errors</h4>
            <p>Ensure CSV uses RFC 4180 format: quoted fields for values containing commas, doubled quotes for escaping.</p>
        </div>
    </div>
</div>

<!-- ═══════════════════ TAB: CHEAT SHEET ═══════════════════ -->
<div class="tab-panel" id="tab-cheatsheet">
    <h2>Quick Reference Cheat Sheet</h2>
    <p class="section-subtitle">Everything you need at a glance.</p>

    <div class="cheat-grid">
        <div class="cheat-card">
            <h4>Start the Server</h4>
<pre><code><span class="hl-comment"># Via Docker Compose</span>
docker compose up -d salesforce-api-mock

<span class="hl-comment"># Or standalone</span>
cd custom-server
npm install
node server.js</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Health Check</h4>
<pre><code>curl http://localhost:8080/health
curl http://localhost:8080/__admin/health</code></pre>
        </div>
        <div class="cheat-card">
            <h4>OAuth Token</h4>
<pre><code>curl -X POST \
  http://localhost:8080/services/oauth2/token \
  -d "grant_type=password"</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Create Record</h4>
<pre><code>curl -X POST \
  http://localhost:8080/services/data/v59.0/\
sobjects/Account \
  -H "Content-Type: application/json" \
  -d '{"Name":"Acme","Type":"Customer"}'</code></pre>
        </div>
        <div class="cheat-card">
            <h4>SOQL Query</h4>
<pre><code>curl "http://localhost:8080/services/\
data/v59.0/query?q=SELECT+Id,Name+\
FROM+Account+WHERE+Type='Customer'"</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Describe Object</h4>
<pre><code>curl http://localhost:8080/services/\
data/v59.0/sobjects/Account/describe</code></pre>
        </div>
        <div class="cheat-card">
            <h4>View All Data</h4>
<pre><code>curl http://localhost:8080/__admin/db
curl http://localhost:8080/__admin/db/Account</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Reset Database</h4>
<pre><code>curl -X POST http://localhost:8080/__admin/reset</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Bulk Insert (v2)</h4>
<pre><code><span class="hl-comment"># 1. Create job</span>
curl -X POST http://localhost:8080/services/\
data/v59.0/jobs/ingest \
  -H "Content-Type: application/json" \
  -d '{"object":"Account","operation":"insert"}'

<span class="hl-comment"># 2. Upload CSV</span>
curl -X PUT http://localhost:8080/services/\
data/v59.0/jobs/ingest/{id}/batches \
  -H "Content-Type: text/csv" \
  -d 'Name,Type
Acme,Customer
Beta,Partner'

<span class="hl-comment"># 3. Close job</span>
curl -X PATCH http://localhost:8080/services/\
data/v59.0/jobs/ingest/{id} \
  -H "Content-Type: application/json" \
  -d '{"state":"UploadComplete"}'</code></pre>
        </div>
        <div class="cheat-card">
            <h4>SnapLogic Account Config</h4>
<pre><code>Login URL:   https://salesforce-api-mock:8443
Username:    any value
Password:    any value
Sandbox:     true
API Version: 59.0</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Endpoints (Host)</h4>
<pre><code>HTTP:    http://localhost:8080
HTTPS:   https://localhost:8443
Admin:   http://localhost:8080/__admin/
Health:  http://localhost:8080/health</code></pre>
        </div>
        <div class="cheat-card">
            <h4>Endpoints (Docker Network)</h4>
<pre><code>HTTP:    http://salesforce-api-mock:8080
HTTPS:   https://salesforce-api-mock:8443</code></pre>
        </div>
    </div>
</div>

</div><!-- end .container -->

<script>
// Main Tabs
document.querySelectorAll('.main-tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    });
});

// Sub Tabs
document.querySelectorAll('.sub-tab').forEach(tab => {
    tab.addEventListener('click', () => {
        const group = tab.closest('.sub-tabs').dataset.group;
        const parent = tab.closest('.tab-panel');
        parent.querySelectorAll(`.sub-tabs[data-group="${group}"] .sub-tab`).forEach(t => t.classList.remove('active'));
        parent.querySelectorAll('.sub-panel').forEach(p => {
            if (p.id.startsWith('subtab-' + group.substring(0, 4))) p.classList.remove('active');
        });
        tab.classList.add('active');
        document.getElementById('subtab-' + tab.dataset.subtab).classList.add('active');
    });
});
</script>
</body>
</html>
